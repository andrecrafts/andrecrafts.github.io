<!DOCTYPE html><html lang="en" data-mode="dark" class="scroll-smooth" data-astro-cid-ouamjn2i> <head><!-- Basic Meta Tags --><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="Astro v5.14.6"><!-- Icons & Links --><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="icon" type="image/png" href="/favicon.png" sizes="96x96"><link rel="icon" href="/favicon.ico" sizes="any"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/site.webmanifest"><link rel="sitemap" href="/sitemap-index.xml"><link rel="canonical" href="https://andrecrafts.com"><!-- Page Title & Description --><title>Writing custom Shellcode: C++ to ASM to Shellcode</title><meta name="description" content="Learn how to easily write custom Shellcode by converting C++ to ASM to Shellcode."><!-- Social Media / Open Graph Tags --><meta property="og:title" content="Writing custom Shellcode: C++ to ASM to Shellcode | AndreCrafts"><meta property="og:description" content="Learn how to easily write custom Shellcode by converting C++ to ASM to Shellcode."><meta property="og:type" content="website"><meta property="og:url" content="https://andrecrafts.com/posts/writing-custom-shellcode-cpp-to-asm-to-shellcode/"><meta property="og:image" content="https://andrecrafts.com/heroImages/writing-custom-shellcode.png"><meta property="twitter:card" content="summary_large_image"><link rel="stylesheet" href="/_astro/about.B3NFc2Ml.css">
<style>@font-face{font-family:Inter;src:url(/fonts/Inter.ttf) format("truetype-variations");font-weight:100 900;font-display:swap;font-style:normal}@font-face{font-family:Montserrat;src:url(/fonts/Montserrat.ttf) format("truetype-variations");font-weight:100 900;font-display:swap;font-style:normal}header[data-astro-cid-3ef6ksr2]#main-header[aria-expanded=true],header[data-astro-cid-3ef6ksr2]#main-header[data-scrolled=true]{background-color:color-mix(in srgb,var(--colors-header) var(--un-bg-opacity),transparent);transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,--un-gradient-from,--un-gradient-via,--un-gradient-to;transition-timing-function:var(--un-ease, var(--default-transition-timingFunction));transition-duration:var(--un-duration, var(--default-transition-duration));--un-duration:.3s;transition-duration:.3s}@supports (color: color-mix(in lab,red,red)){header[data-astro-cid-3ef6ksr2]#main-header[aria-expanded=true],header[data-astro-cid-3ef6ksr2]#main-header[data-scrolled=true]{background-color:color-mix(in oklab,var(--colors-header) var(--un-bg-opacity),transparent)}}a[data-astro-cid-3ef6ksr2][aria-current=page]{color:var(--color-sky-500)}.highlight-btn[data-astro-cid-sz7xmlte]:hover{color:color-mix(in srgb,var(--colors-sky-400) var(--un-text-opacity),transparent)}@property --un-text-opacity{syntax:"<percentage>";inherits:false;initial-value:100%;}@supports (color: color-mix(in lab,red,red)){.highlight-btn[data-astro-cid-sz7xmlte]:hover{color:color-mix(in oklab,var(--colors-sky-400) var(--un-text-opacity),transparent)}}.tooltip-arrow[data-astro-cid-sz7xmlte]{background-color:color-mix(in srgb,var(--colors-secondary-accent) var(--un-bg-opacity),transparent);clip-path:polygon(50% 100%,0 0,100% 0)}@property --un-bg-opacity{syntax:"<percentage>";inherits:false;initial-value:100%;}@supports (color: color-mix(in lab,red,red)){.tooltip-arrow[data-astro-cid-sz7xmlte]{background-color:color-mix(in oklab,var(--colors-secondary-accent) var(--un-bg-opacity),transparent)}}:root{@media (min-width: 1024px){font-size:1.27rem}--background: hsl(214, 44%, 8%)}html{scroll-padding-top:3rem}
</style>
<link rel="stylesheet" href="/_astro/_slug_.xiPQw92k.css">
<style>.title-clamp[data-astro-cid-r7kjq4ip]{display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:3;overflow:hidden}.description-clamp[data-astro-cid-r7kjq4ip]{display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:3;overflow:hidden;overflow-wrap:anywhere}.hide-scrollbar[data-astro-cid-oyovcjtc]{scrollbar-width:thin;scrollbar-color:transparent transparent}.dot[data-astro-cid-oyovcjtc].active{background-color:color-mix(in srgb,var(--colors-sky-500) var(--un-bg-opacity),transparent)}@property --un-bg-opacity{syntax:"<percentage>";inherits:false;initial-value:100%;}@supports (color: color-mix(in lab,red,red)){.dot[data-astro-cid-oyovcjtc].active{background-color:color-mix(in oklab,var(--colors-sky-500) var(--un-bg-opacity),transparent)}}@media (min-width: 768px){.dot[data-astro-cid-oyovcjtc]:nth-child(n+3){display:none}}
.img-class[data-astro-cid-qqdm6bys]{cursor:pointer;transition:opacity .2s ease-in-out}.img-class[data-astro-cid-qqdm6bys]:hover{opacity:.85}
</style></head> <body class="bg-background text-white font-sans selection:bg-sky-500 selection:text-white" data-astro-cid-ouamjn2i> <header id="main-header" data-scrolled="true" class="sticky top-0 z-50" data-astro-cid-3ef6ksr2> <div class="mx-auto px-4 py-1" data-astro-cid-3ef6ksr2> <div class="flex items-center justify-between -ml-1" data-astro-cid-3ef6ksr2> <!-- Logo --> <a href="/" class="flex items-center gap-1" data-astro-cid-3ef6ksr2> <img src="/images/logo.png" alt="AndreCrafts Logo" class="h-10 w-10 object-contain" data-astro-cid-3ef6ksr2> <span class="text-xl font-bold font-display text-white" data-astro-cid-3ef6ksr2>
AndreCrafts
</span> </a> <nav id="menu" class="
  bg-header absolute top-full left-0 w-full 
  border-t-1 border-white 
  hidden flex-col gap-4 p-4
  md:flex md:static md:w-auto md:bg-transparent
  md:border-t-0 md:flex-row md:items-center md:gap-8 md:p-0 " data-astro-cid-3ef6ksr2> <a href="/#services" class="text-white
           hover:text-sky-500 transition-colors duration-300" aria-current="false" data-astro-cid-3ef6ksr2> Services </a><a href="/work" class="text-white
           hover:text-sky-500 transition-colors duration-300" aria-current="false" data-astro-cid-3ef6ksr2> Work </a><a href="/about" class="text-white
           hover:text-sky-500 transition-colors duration-300" aria-current="false" data-astro-cid-3ef6ksr2> About </a> <a href="/#contact" class="
  text-center text-white font-bold px-3 py-1.5 rounded-md 
  bg-[linear-gradient(to_top_right,theme(colors.cyan.500),theme(colors.blue.600))] 
  hover:bg-[linear-gradient(to_top_right,theme(colors.cyan.400),theme(colors.blue.500))] 
  transition-all duration-300
" data-astro-cid-3ef6ksr2>
Contact
</a> </nav> <!-- Mobile Menu Button (Hamburger) --> <button id="mobile-menu-button" class="cursor-pointer text-white md:hidden" aria-controls="mobile-menu" aria-expanded="false" aria-label="Open main menu" data-astro-cid-3ef6ksr2> <svg class="h-6 w-6" id="hamburger-icon" data-astro-cid-3ef6ksr2="true" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"> <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path> </svg> <svg class="h-6 w-6 hidden" id="close-icon" data-astro-cid-3ef6ksr2="true" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"> <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path> </svg> </button> </div> </div> </header> <script type="module">function n(){const t=window.location.pathname,c=window.location.hash;document.querySelectorAll("#menu a").forEach(a=>{const i=new URL(a.href),s=i.pathname,o=i.hash,d=["/work","/posts","/projects"],r=t.endsWith("/")&&t.length>1?t.slice(0,-1):t;if(o==="#contact")return;let e=!1;o?e=o===c:s==="/work"?e=d.includes(r):s==="/"?e=r==="/":e=r===s,e?a.setAttribute("aria-current","page"):a.removeAttribute("aria-current")})}document.addEventListener("DOMContentLoaded",n);window.addEventListener("hashchange",n);window.addEventListener("urlchange",n);window.addEventListener("popstate",n);</script>  <script type="module">const e=document.getElementById("mobile-menu-button"),t=document.getElementById("menu"),i=document.getElementById("hamburger-icon"),d=document.getElementById("close-icon"),o=document.getElementById("main-header");function c(){if(!t||!i||!d||!e||!o)return;t.classList.toggle("hidden"),t.classList.toggle("flex"),i.classList.toggle("hidden"),d.classList.toggle("hidden");const n=e.getAttribute("aria-expanded")==="true";e.setAttribute("aria-expanded",String(!n)),o.setAttribute("aria-expanded",String(!n))}e&&t&&i&&d&&o&&(e.addEventListener("click",c),t.querySelectorAll("a").forEach(s=>{s.addEventListener("click",()=>{e.getAttribute("aria-expanded")==="true"&&c()})}));</script>  <main data-astro-cid-ouamjn2i> <!-- The content of the page will be injected here -->  <div id="content-div" class="max-w-7xl mx-auto pt-4 px-4 lg:px-0 lg:ml-[17%] lg:grid lg:grid-cols-12 lg:gap-x-12" data-astro-cid-scuu7fyy> <article class="lg:col-span-7" data-astro-cid-scuu7fyy> <header data-astro-cid-scuu7fyy> <h1 class="text-3xl md:text-4xl mb-2 font-semibold" data-astro-cid-scuu7fyy>Writing custom Shellcode: C++ to ASM to Shellcode</h1> <h3 class="mb-4 wrap-anywhere" data-astro-cid-scuu7fyy>Learn how to easily write custom Shellcode by converting C++ to ASM to Shellcode.</h3> <div class="w-full aspect-[204/100] 
rounded-lg bg-black mb-2 overflow-hidden flex justify-center items-center" data-astro-cid-scuu7fyy> <!-- If scale exists, then apply the img-class class --><img src="/_astro/writing-custom-shellcode.BMfL58rv_oe4oP.png" alt="Hero image for Writing custom Shellcode: C++ to ASM to Shellcode" data-astro-cid-scuu7fyy="true" data-full-src="/_astro/writing-custom-shellcode.BMfL58rv.png" data-astro-cid-qqdm6bys="true" loading="lazy" decoding="async" fetchpriority="auto" width="1286" height="630" class="h-full w-auto object-cover img-class">  </div> <div class="text-sm text-subtle-gray mb-6 flex flex-wrap justify-between gap-x-4 gap-y-2 " data-astro-cid-scuu7fyy> <span class="" data-astro-cid-scuu7fyy>Posted <span class="font-semibold text-slate-300" data-astro-cid-scuu7fyy>10 Aug 2024</span></span> <span data-astro-cid-scuu7fyy>By <a class="font-semibold text-slate-300 hover:text-sky-500 hover:underline" href="/about" data-astro-cid-scuu7fyy>André Oliveira</a></span> </div> <!-- Project --> <div class="md:text-lg flex flex-row justify-left items-center gap-2 mb-6 text-sky-500" data-astro-cid-scuu7fyy>  <div id="share-trigger" class="cursor-pointer font-semibold flex items-center gap-1 hover:text-sky-400 hover:underline transition-colors " data-astro-cid-scuu7fyy> <svg class="w-6 h-auto" data-astro-cid-scuu7fyy="true" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <g fill="currentColor"> <path d="M6.746704,4 L10.2109085,4 C10.625122,4 10.9609085,4.33578644 10.9609085,4.75 C10.9609085,5.12969577 10.6787546,5.44349096 10.312679,5.49315338 L10.2109085,5.5 L6.746704,5.5 C5.55584001,5.5 4.58105908,6.42516159 4.50189481,7.59595119 L4.496704,7.75 L4.496704,17.25 C4.496704,18.440864 5.42186559,19.4156449 6.59265519,19.4948092 L6.746704,19.5 L16.247437,19.5 C17.438301,19.5 18.4130819,18.5748384 18.4922462,17.4040488 L18.497437,17.25 L18.497437,16.752219 C18.497437,16.3380054 18.8332234,16.002219 19.247437,16.002219 C19.6271328,16.002219 19.940928,16.2843728 19.9905904,16.6504484 L19.997437,16.752219 L19.997437,17.25 C19.997437,19.2542592 18.4250759,20.8912737 16.4465956,20.994802 L16.247437,21 L6.746704,21 C4.74244483,21 3.10543026,19.4276389 3.00190201,17.4491586 L2.996704,17.25 L2.996704,7.75 C2.996704,5.74574083 4.56906505,4.10872626 6.54754543,4.00519801 L6.746704,4 L10.2109085,4 L6.746704,4 Z M14.5006976,6.51985416 L14.5006976,3.75 C14.5006976,3.12602964 15.20748,2.7899466 15.6876724,3.13980165 L15.7698701,3.20874226 L21.7644714,8.95874226 C22.0442311,9.22708681 22.0696965,9.65811353 21.8408438,9.95607385 L21.7645584,10.0411742 L15.7699571,15.7930263 C15.3196822,16.2250675 14.5877784,15.9476738 14.5078455,15.3589039 L14.5006976,15.2518521 L14.5006976,12.5265324 L14.1572053,12.5566444 C11.7575155,12.8069657 9.45747516,13.8878535 7.24265269,15.8173548 C6.72354372,16.2695904 5.9204142,15.8420034 6.00578894,15.1588473 C6.67057872,9.83929778 9.45245108,6.90729635 14.2013326,6.53950096 L14.5006976,6.51985416 L14.5006976,3.75 L14.5006976,6.51985416 Z M16.0006976,5.50864341 L16.0006976,7.25 C16.0006976,7.66421356 15.6649111,8 15.2506976,8 C11.3772927,8 8.97667396,9.67612932 7.93942891,13.1571821 L7.86037164,13.4357543 L8.21256044,13.1989337 C10.4490427,11.7371925 12.7984587,11 15.2506976,11 C15.6303934,11 15.9441885,11.2821539 15.993851,11.6482294 L16.0006976,11.75 L16.0006976,13.4928166 L20.1619348,9.50008715 L16.0006976,5.50864341 Z" id="🎨-Color"></path> </g> </g> </svg>
Share
</div>  </div> </header> <hr class="mt-6 mb-6 border-gray-700" data-astro-cid-scuu7fyy> <!-- ToC Button section --> <button id="toc-trigger" class="flex items-center gap-1 lg:hidden mb-6 cursor-pointer font-semibold py-2 pl-4 pr-2 rounded-md bg-secondary-accent hover:bg-white/20 transition-colors" data-astro-cid-scuu7fyy>
Table of Contents
<svg class="w-5 h-auto rotate-180" data-astro-cid-scuu7fyy="true" fill="none" stroke="currentColor" viewBox="0 0 24 24"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path> </svg> </button> <!-- Content sections --> <div class="content-style " data-astro-cid-scuu7fyy>  <p>Writing custom shellcode can make the process of evading AVs much easier. However, writing Assembly code line by line can be quite labour-intensive.</p>
<p>A solution proposed in <a href="https://vxug.fakedoma.in/papers/VXUG/Exclusive/FromaCprojectthroughassemblytoshellcodeHasherezade.pdf">Hasherezade</a>’s paper is to first create a C/C++ program, then convert it to assembly code. After generating a <code>.exe</code> from this ASM code, you can extract the shellcode from the <code>.text</code> section.</p>
<p>This approach allows for easier development of custom shellcode, and we can directly use the shellcode with shellcode injection techniques.</p>
<p>In this post, I will use a Local Payload execution technique as an example.</p>
<h3 id="1-preparing-dev-environment">1. Preparing Dev Environment</h3>
<p>1. Search for VsDevCmd.bat. This file should be located at:</p>
<div class="code-block-wrapper" data-astro-cid-jgrc2lfe> <pre class="astro-code github-dark astro-jgrc2lfe" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="batch" data-astro-cid-jgrc2lfe><code><span class="line"><span style="color:#E1E4E8">%ProgramFiles%\Microsoft Visual Studio\2022\Community\Common7\Tools</span></span></code></pre> <div class="copy-area" data-astro-cid-jgrc2lfe> <button class="copy-button" title="Copy code" data-astro-cid-jgrc2lfe> <svg class="copy-icon w-6 h-6" data-astro-cid-jgrc2lfe="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"> <path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path> </svg> <svg class="success-icon w-6 h-6" data-astro-cid-jgrc2lfe="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"> <polyline points="20 6 9 17 4 12"></polyline> </svg> </button> </div> </div> <script type="module">function r(e){e.classList.toggle("copied"),setTimeout(()=>{e.classList.toggle("copied")},2e3)}function i(e){const t=e.closest(".code-block-wrapper")?.querySelector("pre");if(!t)return;const c=t.querySelector("code")?.innerText||"";navigator.clipboard.writeText(c).then(()=>{r(e)}).catch(n=>{console.error("Failed to copy text: ",n)})}function s(){document.querySelectorAll(".copy-button").forEach(o=>{o instanceof HTMLButtonElement&&o.addEventListener("click",()=>i(o))})}document.addEventListener("DOMContentLoaded",s);</script> 
<p>2. You can start by running the following command:</p>
<div class="code-block-wrapper" data-astro-cid-jgrc2lfe> <pre class="astro-code github-dark astro-jgrc2lfe" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="batch" data-astro-cid-jgrc2lfe><code><span class="line"><span style="color:#F97583">cmd</span><span style="color:#E1E4E8"> /k </span><span style="color:#9ECBFF">&quot;C:\Program Files\Microsoft Visual Studio\2022\Community\Common7\Tools\VsDevCmd.bat&quot;</span></span>
<span class="line"></span></code></pre> <div class="copy-area" data-astro-cid-jgrc2lfe> <button class="copy-button" title="Copy code" data-astro-cid-jgrc2lfe> <svg class="copy-icon w-6 h-6" data-astro-cid-jgrc2lfe="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"> <path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path> </svg> <svg class="success-icon w-6 h-6" data-astro-cid-jgrc2lfe="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"> <polyline points="20 6 9 17 4 12"></polyline> </svg> </button> </div> </div>  
<ul>
<li>
<!-- If scale exists, then apply the img-class class --><img src="/_astro/0fa90745d1774fc2b5c1b60754e59b45.yCJqqxlz_2m5k4U.png" alt="e17df2f1d0167b81c9c97606d4e43a3a.png" data-full-src="/_astro/0fa90745d1774fc2b5c1b60754e59b45.yCJqqxlz.png" data-astro-cid-qqdm6bys="true" loading="lazy" decoding="async" fetchpriority="auto" width="509" height="87" class="img-class"> 
</li>
</ul>
<h3 id="2-converting-c-to-assembly">2. Converting C++ to Assembly</h3>
<p>We will convert this 2 C++ files to Assembly:</p>
<ul>
<li>
<p><a href="#filecpp">file.cpp</a> - the program that pops a message box.</p>
</li>
<li>
<p><a href="#peb-lookup-header">peb-lookup.h</a> - header file required by the <code>file.cpp</code>, which contains functions for resolving addresses for <code>LoadLibraryA</code> and <code>GetProcAddress</code></p>
</li>
</ul>
<p>Using the Dev Environment from before, you can convert the C++ code to Assembly:</p>
<ul>
<li>Don’t forget to use the <code>x64</code> version of <code>cl.exe</code>.</li>
</ul>
<div class="code-block-wrapper" data-astro-cid-jgrc2lfe> <pre class="astro-code github-dark astro-jgrc2lfe" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="batch" data-astro-cid-jgrc2lfe><code><span class="line"><span style="color:#9ECBFF">&quot;C:\Program Files\Microsoft Visual Studio\2022\Community\VC\Tools\MSVC\14.40.33807\bin\Hostx64\x64\cl.exe&quot;</span><span style="color:#E1E4E8"> /c /FAs /GS- file.cpp</span></span></code></pre> <div class="copy-area" data-astro-cid-jgrc2lfe> <button class="copy-button" title="Copy code" data-astro-cid-jgrc2lfe> <svg class="copy-icon w-6 h-6" data-astro-cid-jgrc2lfe="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"> <path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path> </svg> <svg class="success-icon w-6 h-6" data-astro-cid-jgrc2lfe="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"> <polyline points="20 6 9 17 4 12"></polyline> </svg> </button> </div> </div>  
<ul>
<li>
<!-- If scale exists, then apply the img-class class --><img src="/_astro/d907d7e7e57a4b3084032a66caf79514.0uc4vZQ3_13oQA5.png" alt="c1097bb23a149697c2974341d09c805a.png" data-full-src="/_astro/d907d7e7e57a4b3084032a66caf79514.0uc4vZQ3.png" data-astro-cid-qqdm6bys="true" loading="lazy" decoding="async" fetchpriority="auto" width="650" height="54" class="img-class"> 
</li>
</ul>
<p>This should generate a <code>.asm</code> file:</p>
<ul>
<li>
<!-- If scale exists, then apply the img-class class --><img src="/_astro/9f72ada722d54ba78ae8dd3ea3bc2079.Bjcj9adN_Z1sTYlg.png" alt="3aabccf10419ebc335ba5b08f14081cd.png" data-full-src="/_astro/9f72ada722d54ba78ae8dd3ea3bc2079.Bjcj9adN.png" data-astro-cid-qqdm6bys="true" loading="lazy" decoding="async" fetchpriority="auto" width="458" height="86" class="img-class"> 
</li>
</ul>
<h4 id="filecpp">file.cpp</h4>
<div class="code-block-wrapper" data-astro-cid-jgrc2lfe> <pre class="astro-code github-dark astro-jgrc2lfe" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="c" data-astro-cid-jgrc2lfe><code><span class="line"><span style="color:#F97583">#include</span><span style="color:#9ECBFF"> &lt;Windows.h&gt;</span></span>
<span class="line"><span style="color:#F97583">#include</span><span style="color:#9ECBFF"> &quot;peb-lookup.h&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// It&#39;s worth noting that strings can be defined inside the .text section:</span></span>
<span class="line"><span style="color:#F97583">#pragma</span><span style="color:#B392F0"> code_seg</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;.text&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">int</span><span style="color:#B392F0"> main</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#6A737D">    // Stack based strings for libraries and functions the shellcode needs</span></span>
<span class="line"><span style="color:#79B8FF">    wchar_t</span><span style="color:#E1E4E8"> kernel32_dll_name</span><span style="color:#F97583">[]</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> { </span><span style="color:#9ECBFF">&#39;k&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;e&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;r&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;n&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;e&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;l&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;3&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;2&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;.&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;d&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;l&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;l&#39;</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8"> };</span></span>
<span class="line"><span style="color:#F97583">    char</span><span style="color:#E1E4E8"> load_lib_name</span><span style="color:#F97583">[]</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> { </span><span style="color:#9ECBFF">&#39;L&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;o&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;a&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;d&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;L&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;i&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;b&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;r&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;a&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;r&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;y&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;A&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8"> };</span></span>
<span class="line"><span style="color:#F97583">    char</span><span style="color:#E1E4E8"> get_proc_name</span><span style="color:#F97583">[]</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> { </span><span style="color:#9ECBFF">&#39;G&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;e&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;t&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;P&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;r&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;o&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;c&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;A&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;d&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;d&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;r&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;e&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;s&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;s&#39;</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8"> };</span></span>
<span class="line"><span style="color:#F97583">    char</span><span style="color:#E1E4E8"> user32_dll_name</span><span style="color:#F97583">[]</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> { </span><span style="color:#9ECBFF">&#39;u&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;s&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;e&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;r&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;3&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;2&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;.&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;d&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;l&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;l&#39;</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8"> };</span></span>
<span class="line"><span style="color:#F97583">    char</span><span style="color:#E1E4E8"> message_box_name</span><span style="color:#F97583">[]</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> { </span><span style="color:#9ECBFF">&#39;M&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;e&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;s&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;s&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;a&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;g&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;e&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;B&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;o&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;x&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;W&#39;</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8"> };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // stack based strings to be passed to the messagebox win api</span></span>
<span class="line"><span style="color:#79B8FF">    wchar_t</span><span style="color:#E1E4E8"> msg_content</span><span style="color:#F97583">[]</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> { </span><span style="color:#9ECBFF">&#39;H&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;e&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;l&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;l&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;o&#39;</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">&#39; &#39;</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">&#39;W&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;o&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;r&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;l&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;d&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;!&#39;</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8"> };</span></span>
<span class="line"><span style="color:#79B8FF">    wchar_t</span><span style="color:#E1E4E8"> msg_title</span><span style="color:#F97583">[]</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> { </span><span style="color:#9ECBFF">&#39;D&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;e&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;m&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;o&#39;</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">&#39;!&#39;</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8"> };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // resolve kernel32 image base</span></span>
<span class="line"><span style="color:#E1E4E8">    LPVOID base </span><span style="color:#F97583">=</span><span style="color:#B392F0"> get_module_by_name</span><span style="color:#E1E4E8">((</span><span style="color:#F97583">const</span><span style="color:#E1E4E8"> LPWSTR)kernel32_dll_name);</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">!</span><span style="color:#E1E4E8">base) {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // resolve loadlibraryA() address</span></span>
<span class="line"><span style="color:#E1E4E8">    LPVOID load_lib </span><span style="color:#F97583">=</span><span style="color:#B392F0"> get_func_by_name</span><span style="color:#E1E4E8">((HMODULE)base, (LPSTR)load_lib_name);</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">!</span><span style="color:#E1E4E8">load_lib) {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // resolve getprocaddress() address</span></span>
<span class="line"><span style="color:#E1E4E8">    LPVOID get_proc </span><span style="color:#F97583">=</span><span style="color:#B392F0"> get_func_by_name</span><span style="color:#E1E4E8">((HMODULE)base, (LPSTR)get_proc_name);</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">!</span><span style="color:#E1E4E8">get_proc) {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // loadlibrarya and getprocaddress function definitions</span></span>
<span class="line"><span style="color:#B392F0">    HMODULE</span><span style="color:#E1E4E8">(WINAPI </span><span style="color:#F97583">*</span><span style="color:#E1E4E8"> _LoadLibraryA)(LPCSTR lpLibFileName) </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (</span><span style="color:#B392F0">HMODULE</span><span style="color:#E1E4E8">(WINAPI</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)(LPCSTR))load_lib;</span></span>
<span class="line"><span style="color:#B392F0">    FARPROC</span><span style="color:#E1E4E8">(WINAPI </span><span style="color:#F97583">*</span><span style="color:#E1E4E8"> _GetProcAddress)(HMODULE hModule, LPCSTR lpProcName)</span></span>
<span class="line"><span style="color:#F97583">        =</span><span style="color:#E1E4E8"> (</span><span style="color:#B392F0">FARPROC</span><span style="color:#E1E4E8">(WINAPI</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)(HMODULE, LPCSTR)) get_proc;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // load user32.dll</span></span>
<span class="line"><span style="color:#E1E4E8">    LPVOID u32_dll </span><span style="color:#F97583">=</span><span style="color:#B392F0"> _LoadLibraryA</span><span style="color:#E1E4E8">(user32_dll_name);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // messageboxw function definition</span></span>
<span class="line"><span style="color:#F97583">    int</span><span style="color:#E1E4E8"> (WINAPI </span><span style="color:#F97583">*</span><span style="color:#E1E4E8"> _MessageBoxW)(</span></span>
<span class="line"><span style="color:#E1E4E8">        _In_opt_ HWND hWnd,</span></span>
<span class="line"><span style="color:#E1E4E8">        _In_opt_ LPCWSTR lpText,</span></span>
<span class="line"><span style="color:#E1E4E8">        _In_opt_ LPCWSTR lpCaption,</span></span>
<span class="line"><span style="color:#E1E4E8">        _In_ UINT uType) </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">int</span><span style="color:#E1E4E8"> (WINAPI</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)(</span></span>
<span class="line"><span style="color:#E1E4E8">            _In_opt_ HWND,</span></span>
<span class="line"><span style="color:#E1E4E8">            _In_opt_ LPCWSTR,</span></span>
<span class="line"><span style="color:#E1E4E8">            _In_opt_ LPCWSTR,</span></span>
<span class="line"><span style="color:#E1E4E8">            _In_ UINT)) </span><span style="color:#B392F0">_GetProcAddress</span><span style="color:#E1E4E8">((HMODULE)u32_dll, message_box_name);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> (_MessageBoxW </span><span style="color:#F97583">==</span><span style="color:#79B8FF"> NULL</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">return</span><span style="color:#79B8FF"> 4</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // invoke the message box winapi</span></span>
<span class="line"><span style="color:#B392F0">    _MessageBoxW</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, msg_content, msg_title, MB_OK);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre> <div class="copy-area" data-astro-cid-jgrc2lfe> <button class="copy-button" title="Copy code" data-astro-cid-jgrc2lfe> <svg class="copy-icon w-6 h-6" data-astro-cid-jgrc2lfe="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"> <path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path> </svg> <svg class="success-icon w-6 h-6" data-astro-cid-jgrc2lfe="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"> <polyline points="20 6 9 17 4 12"></polyline> </svg> </button> </div> </div>  
<h4 id="peb-lookup-header">PEB-lookup header</h4>
<div class="code-block-wrapper" data-astro-cid-jgrc2lfe> <pre class="astro-code github-dark astro-jgrc2lfe" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="c" data-astro-cid-jgrc2lfe><code><span class="line"><span style="color:#F97583">#pragma</span><span style="color:#B392F0"> once</span></span>
<span class="line"><span style="color:#F97583">#include</span><span style="color:#9ECBFF"> &lt;Windows.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">#ifndef</span><span style="color:#B392F0"> __NTDLL_H__</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">#ifndef</span><span style="color:#B392F0"> TO_LOWERCASE</span></span>
<span class="line"><span style="color:#F97583">#define</span><span style="color:#B392F0"> TO_LOWERCASE</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">out</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">c1</span><span style="color:#E1E4E8">) (out </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (c1 </span><span style="color:#F97583">&lt;=</span><span style="color:#9ECBFF"> &#39;Z&#39;</span><span style="color:#F97583"> &amp;&amp;</span><span style="color:#E1E4E8"> c1 </span><span style="color:#F97583">&gt;=</span><span style="color:#9ECBFF"> &#39;A&#39;</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">?</span><span style="color:#E1E4E8"> c1 </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (c1 </span><span style="color:#F97583">-</span><span style="color:#9ECBFF"> &#39;A&#39;</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> &#39;a&#39;</span><span style="color:#F97583">:</span><span style="color:#E1E4E8"> c1)</span></span>
<span class="line"><span style="color:#F97583">#endif</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">typedef</span><span style="color:#F97583"> struct</span><span style="color:#E1E4E8"> _UNICODE_STRING</span></span>
<span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#E1E4E8">    USHORT Length;</span></span>
<span class="line"><span style="color:#E1E4E8">    USHORT MaximumLength;</span></span>
<span class="line"><span style="color:#E1E4E8">    PWSTR  Buffer;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">} UNICODE_STRING, </span><span style="color:#F97583">*</span><span style="color:#E1E4E8"> PUNICODE_STRING;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">typedef</span><span style="color:#F97583"> struct</span><span style="color:#E1E4E8"> _PEB_LDR_DATA</span></span>
<span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#E1E4E8">    ULONG Length;</span></span>
<span class="line"><span style="color:#E1E4E8">    BOOLEAN Initialized;</span></span>
<span class="line"><span style="color:#E1E4E8">    HANDLE SsHandle;</span></span>
<span class="line"><span style="color:#E1E4E8">    LIST_ENTRY InLoadOrderModuleList;</span></span>
<span class="line"><span style="color:#E1E4E8">    LIST_ENTRY InMemoryOrderModuleList;</span></span>
<span class="line"><span style="color:#E1E4E8">    LIST_ENTRY InInitializationOrderModuleList;</span></span>
<span class="line"><span style="color:#E1E4E8">    PVOID      EntryInProgress;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">} PEB_LDR_DATA, </span><span style="color:#F97583">*</span><span style="color:#E1E4E8"> PPEB_LDR_DATA;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">//here we don&#39;t want to use any functions imported form extenal modules</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">typedef</span><span style="color:#F97583"> struct</span><span style="color:#E1E4E8"> _LDR_DATA_TABLE_ENTRY {</span></span>
<span class="line"><span style="color:#E1E4E8">    LIST_ENTRY  InLoadOrderModuleList;</span></span>
<span class="line"><span style="color:#E1E4E8">    LIST_ENTRY  InMemoryOrderModuleList;</span></span>
<span class="line"><span style="color:#E1E4E8">    LIST_ENTRY  InInitializationOrderModuleList;</span></span>
<span class="line"><span style="color:#F97583">    void*</span><span style="color:#E1E4E8"> BaseAddress;</span></span>
<span class="line"><span style="color:#F97583">    void*</span><span style="color:#E1E4E8"> EntryPoint;</span></span>
<span class="line"><span style="color:#E1E4E8">    ULONG   SizeOfImage;</span></span>
<span class="line"><span style="color:#E1E4E8">    UNICODE_STRING FullDllName;</span></span>
<span class="line"><span style="color:#E1E4E8">    UNICODE_STRING BaseDllName;</span></span>
<span class="line"><span style="color:#E1E4E8">    ULONG   Flags;</span></span>
<span class="line"><span style="color:#E1E4E8">    SHORT   LoadCount;</span></span>
<span class="line"><span style="color:#E1E4E8">    SHORT   TlsIndex;</span></span>
<span class="line"><span style="color:#E1E4E8">    HANDLE  SectionHandle;</span></span>
<span class="line"><span style="color:#E1E4E8">    ULONG   CheckSum;</span></span>
<span class="line"><span style="color:#E1E4E8">    ULONG   TimeDateStamp;</span></span>
<span class="line"><span style="color:#E1E4E8">} LDR_DATA_TABLE_ENTRY, </span><span style="color:#F97583">*</span><span style="color:#E1E4E8"> PLDR_DATA_TABLE_ENTRY;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">typedef</span><span style="color:#F97583"> struct</span><span style="color:#E1E4E8"> _PEB</span></span>
<span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#E1E4E8">    BOOLEAN InheritedAddressSpace;</span></span>
<span class="line"><span style="color:#E1E4E8">    BOOLEAN ReadImageFileExecOptions;</span></span>
<span class="line"><span style="color:#E1E4E8">    BOOLEAN BeingDebugged;</span></span>
<span class="line"><span style="color:#E1E4E8">    BOOLEAN SpareBool;</span></span>
<span class="line"><span style="color:#E1E4E8">    HANDLE Mutant;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    PVOID ImageBaseAddress;</span></span>
<span class="line"><span style="color:#E1E4E8">    PPEB_LDR_DATA Ldr;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // [...] this is a fragment, more elements follow here</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">} PEB, </span><span style="color:#F97583">*</span><span style="color:#E1E4E8"> PPEB;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">#endif</span><span style="color:#6A737D"> //__NTDLL_H__</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">inline</span><span style="color:#E1E4E8"> LPVOID </span><span style="color:#B392F0">get_module_by_name</span><span style="color:#E1E4E8">(WCHAR</span><span style="color:#F97583">*</span><span style="color:#FFAB70"> module_name</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#E1E4E8">    PPEB peb </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> NULL</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">#if</span><span style="color:#F97583"> defined</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">_WIN64</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    peb </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (PPEB)</span><span style="color:#B392F0">__readgsqword</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">60</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">#else</span></span>
<span class="line"><span style="color:#E1E4E8">    peb </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (PPEB)</span><span style="color:#B392F0">__readfsdword</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">30</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">#endif</span></span>
<span class="line"><span style="color:#E1E4E8">    PPEB_LDR_DATA ldr </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> peb-&gt;Ldr;</span></span>
<span class="line"><span style="color:#E1E4E8">    LIST_ENTRY list </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> ldr-&gt;InLoadOrderModuleList;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    PLDR_DATA_TABLE_ENTRY Flink </span><span style="color:#F97583">=</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8">((PLDR_DATA_TABLE_ENTRY</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)(</span><span style="color:#F97583">&amp;</span><span style="color:#E1E4E8">list));</span></span>
<span class="line"><span style="color:#E1E4E8">    PLDR_DATA_TABLE_ENTRY curr_module </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> Flink;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    while</span><span style="color:#E1E4E8"> (curr_module </span><span style="color:#F97583">!=</span><span style="color:#79B8FF"> NULL</span><span style="color:#F97583"> &amp;&amp;</span><span style="color:#E1E4E8"> curr_module-&gt;BaseAddress </span><span style="color:#F97583">!=</span><span style="color:#79B8FF"> NULL</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (curr_module-&gt;BaseDllName.Buffer </span><span style="color:#F97583">==</span><span style="color:#79B8FF"> NULL</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">continue</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        WCHAR</span><span style="color:#F97583">*</span><span style="color:#E1E4E8"> curr_name </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> curr_module-&gt;BaseDllName.Buffer;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">        size_t</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> (i </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; </span><span style="color:#FFAB70">module_name</span><span style="color:#E1E4E8">[i] </span><span style="color:#F97583">!=</span><span style="color:#79B8FF"> 0</span><span style="color:#F97583"> &amp;&amp;</span><span style="color:#FFAB70"> curr_name</span><span style="color:#E1E4E8">[i] </span><span style="color:#F97583">!=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">            WCHAR c1, c2;</span></span>
<span class="line"><span style="color:#B392F0">            TO_LOWERCASE</span><span style="color:#E1E4E8">(c1, </span><span style="color:#FFAB70">module_name</span><span style="color:#E1E4E8">[i]);</span></span>
<span class="line"><span style="color:#B392F0">            TO_LOWERCASE</span><span style="color:#E1E4E8">(c2, </span><span style="color:#FFAB70">curr_name</span><span style="color:#E1E4E8">[i]);</span></span>
<span class="line"><span style="color:#F97583">            if</span><span style="color:#E1E4E8"> (c1 </span><span style="color:#F97583">!=</span><span style="color:#E1E4E8"> c2) </span><span style="color:#F97583">break</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">module_name</span><span style="color:#E1E4E8">[i] </span><span style="color:#F97583">==</span><span style="color:#79B8FF"> 0</span><span style="color:#F97583"> &amp;&amp;</span><span style="color:#FFAB70"> curr_name</span><span style="color:#E1E4E8">[i] </span><span style="color:#F97583">==</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">            //found</span></span>
<span class="line"><span style="color:#F97583">            return</span><span style="color:#E1E4E8"> curr_module-&gt;BaseAddress;</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#6A737D">        // not found, try next:</span></span>
<span class="line"><span style="color:#E1E4E8">        curr_module </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (PLDR_DATA_TABLE_ENTRY)curr_module-&gt;InLoadOrderModuleList.Flink;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#79B8FF"> NULL</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">inline</span><span style="color:#E1E4E8"> LPVOID </span><span style="color:#B392F0">get_func_by_name</span><span style="color:#E1E4E8">(LPVOID </span><span style="color:#FFAB70">module</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">char*</span><span style="color:#FFAB70"> func_name</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#E1E4E8">    IMAGE_DOS_HEADER</span><span style="color:#F97583">*</span><span style="color:#E1E4E8"> idh </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (IMAGE_DOS_HEADER</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)module;</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> (idh-&gt;e_magic </span><span style="color:#F97583">!=</span><span style="color:#E1E4E8"> IMAGE_DOS_SIGNATURE) {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#79B8FF"> NULL</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    IMAGE_NT_HEADERS</span><span style="color:#F97583">*</span><span style="color:#E1E4E8"> nt_headers </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (IMAGE_NT_HEADERS</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)((BYTE</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)module </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> idh-&gt;e_lfanew);</span></span>
<span class="line"><span style="color:#E1E4E8">    IMAGE_DATA_DIRECTORY</span><span style="color:#F97583">*</span><span style="color:#E1E4E8"> exportsDir </span><span style="color:#F97583">=</span><span style="color:#F97583"> &amp;</span><span style="color:#E1E4E8">(nt_headers-&gt;OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_EXPORT]);</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> (exportsDir-&gt;VirtualAddress </span><span style="color:#F97583">==</span><span style="color:#79B8FF"> NULL</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#79B8FF"> NULL</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    DWORD expAddr </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> exportsDir-&gt;VirtualAddress;</span></span>
<span class="line"><span style="color:#E1E4E8">    IMAGE_EXPORT_DIRECTORY</span><span style="color:#F97583">*</span><span style="color:#E1E4E8"> exp </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (IMAGE_EXPORT_DIRECTORY</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)(expAddr </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> (ULONG_PTR)module);</span></span>
<span class="line"><span style="color:#E1E4E8">    SIZE_T namesCount </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> exp-&gt;NumberOfNames;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    DWORD funcsListRVA </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> exp-&gt;AddressOfFunctions;</span></span>
<span class="line"><span style="color:#E1E4E8">    DWORD funcNamesListRVA </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> exp-&gt;AddressOfNames;</span></span>
<span class="line"><span style="color:#E1E4E8">    DWORD namesOrdsListRVA </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> exp-&gt;AddressOfNameOrdinals;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    //go through names:</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> (SIZE_T i </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; i </span><span style="color:#F97583">&lt;</span><span style="color:#E1E4E8"> namesCount; i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">        DWORD</span><span style="color:#F97583">*</span><span style="color:#E1E4E8"> nameRVA </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (DWORD</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)(funcNamesListRVA </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> (BYTE</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)module </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">*</span><span style="color:#F97583"> sizeof</span><span style="color:#E1E4E8">(DWORD));</span></span>
<span class="line"><span style="color:#E1E4E8">        WORD</span><span style="color:#F97583">*</span><span style="color:#E1E4E8"> nameIndex </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (WORD</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)(namesOrdsListRVA </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> (BYTE</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)module </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">*</span><span style="color:#F97583"> sizeof</span><span style="color:#E1E4E8">(WORD));</span></span>
<span class="line"><span style="color:#E1E4E8">        DWORD</span><span style="color:#F97583">*</span><span style="color:#E1E4E8"> funcRVA </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (DWORD</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)(funcsListRVA </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> (BYTE</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)module </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">nameIndex) </span><span style="color:#F97583">*</span><span style="color:#F97583"> sizeof</span><span style="color:#E1E4E8">(DWORD));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">        LPSTR curr_name </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (LPSTR)(</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">nameRVA </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> (BYTE</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)module);</span></span>
<span class="line"><span style="color:#F97583">        size_t</span><span style="color:#E1E4E8"> k </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> (k </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; </span><span style="color:#FFAB70">func_name</span><span style="color:#E1E4E8">[k] </span><span style="color:#F97583">!=</span><span style="color:#79B8FF"> 0</span><span style="color:#F97583"> &amp;&amp;</span><span style="color:#FFAB70"> curr_name</span><span style="color:#E1E4E8">[k] </span><span style="color:#F97583">!=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; k</span><span style="color:#F97583">++</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">            if</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">func_name</span><span style="color:#E1E4E8">[k] </span><span style="color:#F97583">!=</span><span style="color:#FFAB70"> curr_name</span><span style="color:#E1E4E8">[k]) </span><span style="color:#F97583">break</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">func_name</span><span style="color:#E1E4E8">[k] </span><span style="color:#F97583">==</span><span style="color:#79B8FF"> 0</span><span style="color:#F97583"> &amp;&amp;</span><span style="color:#FFAB70"> curr_name</span><span style="color:#E1E4E8">[k] </span><span style="color:#F97583">==</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">            //found</span></span>
<span class="line"><span style="color:#F97583">            return</span><span style="color:#E1E4E8"> (BYTE</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)module </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">funcRVA);</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#79B8FF"> NULL</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre> <div class="copy-area" data-astro-cid-jgrc2lfe> <button class="copy-button" title="Copy code" data-astro-cid-jgrc2lfe> <svg class="copy-icon w-6 h-6" data-astro-cid-jgrc2lfe="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"> <path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path> </svg> <svg class="success-icon w-6 h-6" data-astro-cid-jgrc2lfe="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"> <polyline points="20 6 9 17 4 12"></polyline> </svg> </button> </div> </div>  
<h3 id="3-fixing-the-asm-file">3. Fixing the .asm file</h3>
<p>After converting the C++ code to assembly, we need to clean up the file a bit, so we can link it to an .exe without errors and to avoid the shellcode from crashing.</p>
<p>Specifically, we need to:</p>
<ol>
<li><a href="#31-remove-dependencies-from-external-libraries">Remove dependencies from external libraries</a></li>
<li><a href="#32-fix-stack-alignment">Fix Stack Alignment</a></li>
<li><a href="#33-remove-pdata-and-xdata-segments">Remove PDATA and XDATA Segments</a></li>
<li><a href="#34-fix-syntax-issues">Fix Syntax Issues</a></li>
</ol>
<h4 id="31-remove-dependencies-from-external-libraries">3.1 Remove dependencies from external libraries</h4>
<p>Remove or comment out the libraries <code>LIBCMT</code> and <code>OLDNAMES</code>.</p>
<ul>
<li>
<!-- If scale exists, then apply the img-class class --><img src="/_astro/fb173d4b4acd4da3bc0537167eeb8bdc.tIXMh3FB_Z2qQVAw.png" alt="78a72023f71401504817b08850f75281.png" data-full-src="/_astro/fb173d4b4acd4da3bc0537167eeb8bdc.tIXMh3FB.png" data-astro-cid-qqdm6bys="true" loading="lazy" decoding="async" fetchpriority="auto" width="472" height="137" class="img-class"> 
</li>
</ul>
<h4 id="32-fix-stack-alignment">3.2 Fix Stack Alignment</h4>
<p>Add procedure <code>AlignRSP</code> right at the top of the first <code>_TEXT</code> segment in our <code>c-shellcode.asm</code>:</p>
<div class="code-block-wrapper" data-astro-cid-jgrc2lfe> <pre class="astro-code github-dark astro-jgrc2lfe" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="plaintext" data-astro-cid-jgrc2lfe><code><span class="line"><span>; https://github.com/mattifestation/PIC_Bindshell/blob/master/PIC_Bindshell/AdjustStack.asm</span></span>
<span class="line"><span></span></span>
<span class="line"><span>; AlignRSP is a simple call stub that ensures that the stack is 16-byte aligned prior</span></span>
<span class="line"><span>; to calling the entry point of the payload. This is necessary because 64-bit functions</span></span>
<span class="line"><span>; in Windows assume that they were called with 16-byte stack alignment. When amd64</span></span>
<span class="line"><span>; shellcode is executed, you can&#39;t be assured that you stack is 16-byte aligned. For example,</span></span>
<span class="line"><span>; if your shellcode lands with 8-byte stack alignment, any call to a Win32 function will likely</span></span>
<span class="line"><span>; crash upon calling any ASM instruction that utilizes XMM registers (which require 16-byte)</span></span>
<span class="line"><span>; alignment.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>AlignRSP PROC</span></span>
<span class="line"><span>    push rsi ; Preserve RSI since we&#39;re stomping on it</span></span>
<span class="line"><span>    mov rsi, rsp ; Save the value of RSP so it can be restored</span></span>
<span class="line"><span>    and rsp, 0FFFFFFFFFFFFFFF0h ; Align RSP to 16 bytes</span></span>
<span class="line"><span>    sub rsp, 020h ; Allocate homing space for ExecutePayload</span></span>
<span class="line"><span>    call main ; Call the entry point of the payload</span></span>
<span class="line"><span>    mov rsp, rsi ; Restore the original value of RSP</span></span>
<span class="line"><span>    pop rsi ; Restore RSI</span></span>
<span class="line"><span>    ret ; Return to caller</span></span>
<span class="line"><span>AlignRSP ENDP</span></span></code></pre> <div class="copy-area" data-astro-cid-jgrc2lfe> <button class="copy-button" title="Copy code" data-astro-cid-jgrc2lfe> <svg class="copy-icon w-6 h-6" data-astro-cid-jgrc2lfe="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"> <path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path> </svg> <svg class="success-icon w-6 h-6" data-astro-cid-jgrc2lfe="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"> <polyline points="20 6 9 17 4 12"></polyline> </svg> </button> </div> </div>  
<h4 id="33-remove-pdata-and-xdata-segments">3.3 Remove PDATA and XDATA Segments</h4>
<p>Remove or comment out <code>PDATA</code> and <code>XDATA</code> segments as shown below:</p>
<ul>
<li>
<!-- If scale exists, then apply the img-class class --><img src="/_astro/3d367ab75f66426fb177102b8b906669.DQa5395G_qzVCR.png" alt="bfa537cf43a3812de7f5f4882809f9d4.png" data-full-src="/_astro/3d367ab75f66426fb177102b8b906669.DQa5395G.png" data-astro-cid-qqdm6bys="true" loading="lazy" decoding="async" fetchpriority="auto" width="385" height="229" class="img-class"> 
</li>
</ul>
<h4 id="34-fix-syntax-issues">3.4 Fix Syntax Issues</h4>
<p>Now, we just need to fix the syntax issues.</p>
<p>We can use the error we get while linking the MASM file to an EXE to assist in fixing syntax.</p>
<p>Possible errors:</p>
<ul>
<li><code>error A2027</code>: operand must be a memory expression
<ul>
<li>Cause: <code>mov rax, QWORD PTR gs:96</code></li>
<li>Solution: Add square brackets <code>[]</code></li>
<li><code>mov rax, QWORD PTR gs:[96]</code></li>
</ul>
</li>
<li><code>error A2006</code>: undefined symbol : FLAT
<ul>
<li>Cause: <code>lea r8, OFFSET FLAT:$SG93137</code></li>
<li>Solution: Remove <code>:FLAT</code></li>
<li><code>lea r8, OFFSET $SG93137</code></li>
</ul>
</li>
<li><code>error LNK2019</code>: unresolved external symbol <code>__imp_MessageBoxA</code> referenced in function main file.exe : fatal error LNK1120: 1 unresolved externals
<ul>
<li>Cause: missing user32.lib</li>
<li>Solution: Add the following line to the ASM code <code>includelib user32.lib</code>.</li>
<li>Note: This should happen because we loaded the library in the C++ code.</li>
<li>Ensure the <code>libpath</code> is pointing to x64 version. So, add this flag to the cl.exe command:</li>
<li><code>/LIBPATH:&quot;C:\Program Files (x86)\Windows Kits\10\Lib\10.0.22621.0\um\x64&quot;</code></li>
</ul>
</li>
</ul>
<h3 id="4-linking-the-asm-code-to-an-exe">4. Linking the ASM code to an EXE</h3>
<p>Now, you need to link the assembly listings inside <code>file.asm</code> to get an executable <code>file.exe</code>:</p>
<div class="code-block-wrapper" data-astro-cid-jgrc2lfe> <pre class="astro-code github-dark astro-jgrc2lfe" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="batch" data-astro-cid-jgrc2lfe><code><span class="line"><span style="color:#9ECBFF">&quot;C:\Program Files\Microsoft Visual Studio\2022\Community\VC\Tools\MSVC\14.40.33807\bin\Hostx64\x64\ml64.exe&quot;</span><span style="color:#E1E4E8"> file.asm /link /entry:AlignRSP</span></span></code></pre> <div class="copy-area" data-astro-cid-jgrc2lfe> <button class="copy-button" title="Copy code" data-astro-cid-jgrc2lfe> <svg class="copy-icon w-6 h-6" data-astro-cid-jgrc2lfe="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"> <path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path> </svg> <svg class="success-icon w-6 h-6" data-astro-cid-jgrc2lfe="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"> <polyline points="20 6 9 17 4 12"></polyline> </svg> </button> </div> </div>  
<ul>
<li>
<!-- If scale exists, then apply the img-class class --><img src="/_astro/144c60e77c7b41a29bee437952541052.De34WlNX_Zbd3iC.png" alt="c919fdc18fb391df6c4146918bd590fc.png" data-full-src="/_astro/144c60e77c7b41a29bee437952541052.De34WlNX.png" data-astro-cid-qqdm6bys="true" loading="lazy" decoding="async" fetchpriority="auto" width="559" height="115" class="img-class"> 
</li>
</ul>
<h3 id="5-testing-the-exe">5. Testing the EXE</h3>
<p>To check if the last step was successful, try running the <code>file.exe</code> that was created from the <code>file.asm</code>.</p>
<ul>
<li>
<!-- If scale exists, then apply the img-class class --><img src="/_astro/415c0afb4ddd40ddbfe4df7af6a6dd48.BI7Y1C7L_Z1LvYp6.png" alt="c28b6e89743b8d1ce7337f9057f3d7bc.png" data-full-src="/_astro/415c0afb4ddd40ddbfe4df7af6a6dd48.BI7Y1C7L.png" data-astro-cid-qqdm6bys="true" loading="lazy" decoding="async" fetchpriority="auto" width="413" height="204" class="img-class"> 
</li>
</ul>
<h3 id="6-copying-and-running-the-shellcode-from-the-exe">6. Copying and Running the Shellcode from the EXE</h3>
<p>Now that we have a working exe, we can extract the shellcode and execute it using any Payload execution techniques.</p>
<p>We can use an hex editor to extract the shellcode from the <code>.text</code> section.</p>
<p>I will use <a href="https://ntcore.com/explorer-suite/">CFF Explorer</a> in this case.</p>
<ol>
<li>Find the Raw Address of <code>.text</code> and <code>.rdata</code> section:
<ul>
<li>For me, the start of <code>.text</code> was at <code>0x200</code> and for <code>.rdata</code> at <code>0xA00</code></li>
<li>
<!-- If scale exists, then apply the img-class class --><img src="/_astro/e118b9c601874d369b21fbbae7c46310.DSqjBxP5_sSihu.png" alt="7b52718224179a7e4137ab1a3bb64879.png" data-full-src="/_astro/e118b9c601874d369b21fbbae7c46310.DSqjBxP5.png" data-astro-cid-qqdm6bys="true" loading="lazy" decoding="async" fetchpriority="auto" width="604" height="86" class="img-class"> 
</li>
</ul>
</li>
<li>Go to Hex editor, and scroll down until the offset corresponds to the Raw Address you found earlier.
<ul>
<li>This will be the start of your shellcode:</li>
<li>
<!-- If scale exists, then apply the img-class class --><img src="/_astro/4e0f70d89f004864b8e642662ec9aeed.BHt7oWfE_9w41E.png" alt="df11b9fe1532a12a8c3cb43c42170f9b.png" data-full-src="/_astro/4e0f70d89f004864b8e642662ec9aeed.BHt7oWfE.png" data-astro-cid-qqdm6bys="true" loading="lazy" decoding="async" fetchpriority="auto" width="451" height="171" class="img-class"> 
</li>
</ul>
</li>
<li>Copy the shellcode starting at the raw address of <code>.text</code> and stopping before the raw address of <code>.rdata</code>.
<ul>
<li>For me, it was from <code>0x200</code> to <code>0x9F0</code>.</li>
<li>Note: <code>0x9F0</code> is the address before <code>0xA00</code>, <code>.rdata</code> address.</li>
<li>
<!-- If scale exists, then apply the img-class class --><img src="/_astro/a6febd158d6f443699edd3ba118a730a.BNxUnfSn_12UMR6.png" alt="348c88458956786d792937260878ce5f.png" data-full-src="/_astro/a6febd158d6f443699edd3ba118a730a.BNxUnfSn.png" data-astro-cid-qqdm6bys="true" loading="lazy" decoding="async" fetchpriority="auto" width="352" height="244" class="img-class"> 
</li>
</ul>
</li>
<li>Since I’m going to use this shellcode on a C/C++ script, I can copy it to C/C++ array:
<ul>
<li>
<!-- If scale exists, then apply the img-class class --><img src="/_astro/da74d444ac9a4da98429ce65ab2fd311.C4Eq2lNN_iKX4y.png" alt="a091074a5b951420fdfdf07c72d178e8.png" data-full-src="/_astro/da74d444ac9a4da98429ce65ab2fd311.C4Eq2lNN.png" data-astro-cid-qqdm6bys="true" loading="lazy" decoding="async" fetchpriority="auto" width="136" height="140" class="img-class"> 
</li>
</ul>
</li>
<li>You can use this shellcode with a shellcode injection techniques.</li>
<li>In this case, I used the Local Payload Execution technique from <a href="https://maldevacademy.com/">Maldev academy</a>.
<ul>
<li>
<!-- If scale exists, then apply the img-class class --><img src="/_astro/fd5a8b62eb544589b9f727f10bec9b5f.81p4ydGD_Z1H8BBm.png" alt="5e307e12025fc94dd6bdff1af77d84d4.png" data-full-src="/_astro/fd5a8b62eb544589b9f727f10bec9b5f.81p4ydGD.png" data-astro-cid-qqdm6bys="true" loading="lazy" decoding="async" fetchpriority="auto" width="607" height="216" class="img-class"> 
</li>
</ul>
</li>
</ol>
<h3 id="references">References</h3>
<ol>
<li><a href="https://medium.com/@shaddy43/the-epitome-of-evasion-a-custom-shellcode-c751a1a17e5b">https://medium.com/@shaddy43/the-epitome-of-evasion-a-custom-shellcode-c751a1a17e5b</a></li>
<li><a href="https://www.ired.team/offensive-security/code-injection-process-injection/writing-and-compiling-shellcode-in-c">https://www.ired.team/offensive-security/code-injection-process-injection/writing-and-compiling-shellcode-in-c</a></li>
</ol>  </div> </article>  <aside class="hidden lg:block lg:col-span-4" data-astro-cid-scuu7fyy> <div class="sticky top-18 flex flex-col max-w-[36ch] h-[calc(95vh-4.5rem)]" data-astro-cid-scuu7fyy> <div class="border-l-1 border-slate-600 pl-3 toc-content-area" data-astro-cid-scuu7fyy> <h2 class="font-semibold text-lg text-gray-200 mb-1" data-astro-cid-scuu7fyy>Table of Contents</h2>
            <div class="max-h-[70vh] overflow-y-auto scroll-fade-container" data-astro-cid-scuu7fyy> <ul class="pl-3 pr-2 " data-astro-cid-xvrfupwn>  </ul> <script type="module">const n=new Map;let o=!1;function a(){document.querySelectorAll("a.toc-link").forEach(i=>i.setAttribute("data-active","false")),document.querySelectorAll("h2[data-active], h3[data-active]").forEach(i=>i.removeAttribute("data-active"))}function d(){const t=document.querySelector("a.toc-link"),e=document.querySelector(".content-style h2, .content-style h3");!t||!e||(t.setAttribute("data-active","true"),t.scrollIntoView({behavior:"smooth",block:"nearest"}),e.setAttribute("data-active","true"))}function u(){let t=!1;const e=()=>{window.scrollY<200&&!t?(a(),d(),t=!0):window.scrollY>=200&&(t=!1)};window.addEventListener("scroll",e)}function s(){const t=document.querySelector('h2[data-active="true"], h3[data-active="true"]');if(t){const e=t.id;document.querySelector(`a.toc-link[href="#${e}"]`)?.setAttribute("data-active","true")}}function h(t){for(const i of t){if(!i.isIntersecting){n.delete(i.target);continue}n.set(i.target,i)}if(n.size===0)return;let e=null;for(const i of Array.from(n.values()))e||(e=i),i.boundingClientRect.top<e.boundingClientRect.top&&(e=i);e?.target.getAttribute("data-active")!=="true"&&(a(),e&&e.target.setAttribute("data-active","true"),o&&s())}function c(t){o=t.matches,o&&s()}function f(){const t=window.matchMedia("(min-width: 1024px)");t.addEventListener("change",c),c(t);const e=document.querySelectorAll(".content-style h2, .content-style h3");if(e.length===0)return;const i={root:null,rootMargin:"0px 0px -60% 0px",threshold:0},r=new IntersectionObserver(h,i);e.forEach(l=>r.observe(l)),u()}document.addEventListener("DOMContentLoaded",()=>{f()});</script>  </div> </div> </div> </aside> <!-- Post-article sections --> <div id="post-article-div" class="lg:col-span-7" data-astro-cid-scuu7fyy> <hr class="mt-10 border-gray-700" data-astro-cid-scuu7fyy> <div id="post-content-section" class="mt-4 mb-5 lg:flex lg:justify-between lg:items-start lg:gap-x-8 lg:gap-y-4" data-astro-cid-scuu7fyy> <!-- Tags Section --> <div id="tag-section" class="mb-4 lg:mb-0" data-astro-cid-scuu7fyy> <div class="text-left mb-2 lg:mb-4 flex items-center gap-1" data-astro-cid-scuu7fyy> <svg class="w-6 h-auto" data-astro-cid-scuu7fyy="true" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"> <defs> <mask id="tagMask1"> <rect width="24" height="24" fill="white"></rect> <circle cx="7" cy="7" r="1.5" fill="black"></circle> </mask> <mask id="tagMask2"> <rect width="24" height="24" fill="white"></rect> <circle cx="5" cy="9" r="1.5" fill="black"></circle> </mask> </defs> <!-- Back tag --> <g transform="translate(2, -2)" opacity="0.6"> <path d="M22.09 15.91L14.92 23.08C14.55 23.45 14.05 23.66 13.52 23.66C12.99 23.66 12.49 23.45 12.12 23.08L3.89 14.85C3.52 14.48 3.31 13.98 3.31 13.45V6.68C3.31 5.62 4.16 4.77 5.22 4.77H11.99C12.52 4.77 13.02 4.98 13.39 5.35L21.62 13.58C21.99 13.95 22.2 14.45 22.2 14.98C22.2 15.51 21.99 16.01 21.62 16.38L22.09 15.91Z" fill="currentColor" opacity="0.6" mask="url(#tagMask2)"></path> </g> <!-- Front tag --> <path d="M20.59 13.41L13.42 20.58C13.05 20.95 12.55 21.16 12.02 21.16C11.49 21.16 10.99 20.95 10.62 20.58L2.39 12.35C2.02 11.98 1.81 11.48 1.81 10.95V4.18C1.81 3.12 2.66 2.27 3.72 2.27H10.49C11.02 2.27 11.52 2.48 11.89 2.85L20.12 11.08C20.49 11.45 20.7 11.95 20.7 12.48C20.7 13.01 20.49 13.51 20.12 13.88L20.59 13.41Z" fill="currentColor" mask="url(#tagMask1)"></path> </svg> <h2 class="text-2xl font-semibold text-white" data-astro-cid-scuu7fyy>Tags</h2> </div> <div id="tags-wrapper" class="flex flex-wrap items-center gap-1" aria-expanded="false" data-astro-cid-scuu7fyy> <!-- Always visible tags (first 7) --> <a href="/work?tags=Shellcode" class="text-xs px-1.7 py-1 rounded-md
bg-secondary-accent hover:bg-gray-600 transition-colors" data-astro-cid-scuu7fyy> Shellcode </a><a href="/work?tags=ASM" class="text-xs px-1.7 py-1 rounded-md
bg-secondary-accent hover:bg-gray-600 transition-colors" data-astro-cid-scuu7fyy> ASM </a><a href="/work?tags=C%2B%2B" class="text-xs px-1.7 py-1 rounded-md
bg-secondary-accent hover:bg-gray-600 transition-colors" data-astro-cid-scuu7fyy> C++ </a><a href="/work?tags=Red%20Team" class="text-xs px-1.7 py-1 rounded-md
bg-secondary-accent hover:bg-gray-600 transition-colors" data-astro-cid-scuu7fyy> Red Team </a><a href="/work?tags=Malware%20Development" class="text-xs px-1.7 py-1 rounded-md
bg-secondary-accent hover:bg-gray-600 transition-colors" data-astro-cid-scuu7fyy> Malware Development </a> <!-- Conditionally rendered "Show More" button --> <div id="more-tags" class="hidden flex-wrap items-center gap-1" data-astro-cid-scuu7fyy> <a href="/work?tags=Reverse%20Engineering" class="text-xs px-1.7 py-1 rounded-md
bg-secondary-accent hover:bg-gray-600 transition-colors" data-astro-cid-scuu7fyy> Reverse Engineering </a><a href="/work?tags=Programming" class="text-xs px-1.7 py-1 rounded-md
bg-secondary-accent hover:bg-gray-600 transition-colors" data-astro-cid-scuu7fyy> Programming </a> </div> <button id="show-all-btn" class="text-sm font-semibold hover:text-sky-400 transition-colors rounded cursor-pointer" data-astro-cid-scuu7fyy>
Show All
</button> <button id="show-less-btn" class="text-sm font-semibold hover:text-sky-400 transition-colors rounded cursor-pointer" data-astro-cid-scuu7fyy>
Show Less
</button>  </div> </div> <!-- Share Section --> <div id="share-section" data-astro-cid-scuu7fyy> <div class="text-left mb-2 flex items-center gap-1" data-astro-cid-scuu7fyy> <svg class="w-7 h-auto" data-astro-cid-scuu7fyy="true" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <g fill="currentColor"> <path d="M6.746704,4 L10.2109085,4 C10.625122,4 10.9609085,4.33578644 10.9609085,4.75 C10.9609085,5.12969577 10.6787546,5.44349096 10.312679,5.49315338 L10.2109085,5.5 L6.746704,5.5 C5.55584001,5.5 4.58105908,6.42516159 4.50189481,7.59595119 L4.496704,7.75 L4.496704,17.25 C4.496704,18.440864 5.42186559,19.4156449 6.59265519,19.4948092 L6.746704,19.5 L16.247437,19.5 C17.438301,19.5 18.4130819,18.5748384 18.4922462,17.4040488 L18.497437,17.25 L18.497437,16.752219 C18.497437,16.3380054 18.8332234,16.002219 19.247437,16.002219 C19.6271328,16.002219 19.940928,16.2843728 19.9905904,16.6504484 L19.997437,16.752219 L19.997437,17.25 C19.997437,19.2542592 18.4250759,20.8912737 16.4465956,20.994802 L16.247437,21 L6.746704,21 C4.74244483,21 3.10543026,19.4276389 3.00190201,17.4491586 L2.996704,17.25 L2.996704,7.75 C2.996704,5.74574083 4.56906505,4.10872626 6.54754543,4.00519801 L6.746704,4 L10.2109085,4 L6.746704,4 Z M14.5006976,6.51985416 L14.5006976,3.75 C14.5006976,3.12602964 15.20748,2.7899466 15.6876724,3.13980165 L15.7698701,3.20874226 L21.7644714,8.95874226 C22.0442311,9.22708681 22.0696965,9.65811353 21.8408438,9.95607385 L21.7645584,10.0411742 L15.7699571,15.7930263 C15.3196822,16.2250675 14.5877784,15.9476738 14.5078455,15.3589039 L14.5006976,15.2518521 L14.5006976,12.5265324 L14.1572053,12.5566444 C11.7575155,12.8069657 9.45747516,13.8878535 7.24265269,15.8173548 C6.72354372,16.2695904 5.9204142,15.8420034 6.00578894,15.1588473 C6.67057872,9.83929778 9.45245108,6.90729635 14.2013326,6.53950096 L14.5006976,6.51985416 L14.5006976,3.75 L14.5006976,6.51985416 Z M16.0006976,5.50864341 L16.0006976,7.25 C16.0006976,7.66421356 15.6649111,8 15.2506976,8 C11.3772927,8 8.97667396,9.67612932 7.93942891,13.1571821 L7.86037164,13.4357543 L8.21256044,13.1989337 C10.4490427,11.7371925 12.7984587,11 15.2506976,11 C15.6303934,11 15.9441885,11.2821539 15.993851,11.6482294 L16.0006976,11.75 L16.0006976,13.4928166 L20.1619348,9.50008715 L16.0006976,5.50864341 Z" id="🎨-Color"></path> </g> </g> </svg> <h2 class="text-2xl font-semibold text-white" data-astro-cid-scuu7fyy>Share</h2> </div> <div class="flex items-center gap-2"> <!-- Twitter --> <div class="group relative inline-flex" data-astro-cid-lejbfuzf> <!-- Whatever you put inside the TooltipWrapper tags goes here -->  <a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fandrecrafts.com%2Fposts%2Fwriting-custom-shellcode-cpp-to-asm-to-shellcode%2F&text=Writing%20custom%20Shellcode%3A%20C%2B%2B%20to%20ASM%20to%20Shellcode" target="_blank" rel="noopener noreferrer" class="p-2 rounded-lg bg-secondary-accent hover:bg-sky-600 text-subtle-gray hover:text-white transition-all duration-200"> <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"> <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.25 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"></path> </svg> </a>  <div role="tooltip" class="tooltip
  absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1.5 
  text-sm font-medium bg-secondary-accent
  rounded-md shadow-lg w-max max-w-xs
  opacity-0 [@media_(hover:hover)]:group-hover:opacity-100
  transition-opacity duration-300 pointer-events-none
" data-astro-cid-lejbfuzf> <span class="tooltip-text" data-astro-cid-lejbfuzf>Twitter</span> <div class="tooltip-arrow absolute left-1/2 -translate-x-1/2
  top-full w-4 h-2
  bg-secondary-accent
" data-astro-cid-lejbfuzf></div> </div> </div> <!-- LinkedIn --> <div class="group relative inline-flex" data-astro-cid-lejbfuzf> <!-- Whatever you put inside the TooltipWrapper tags goes here -->  <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fandrecrafts.com%2Fposts%2Fwriting-custom-shellcode-cpp-to-asm-to-shellcode%2F" target="_blank" rel="noopener noreferrer" class="p-2 rounded-lg bg-secondary-accent hover:bg-sky-600 text-subtle-gray hover:text-white transition-all duration-200"> <svg class="w-5 h-5<" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"> <path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"></path> </svg> </a>  <div role="tooltip" class="tooltip
  absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1.5 
  text-sm font-medium bg-secondary-accent
  rounded-md shadow-lg w-max max-w-xs
  opacity-0 [@media_(hover:hover)]:group-hover:opacity-100
  transition-opacity duration-300 pointer-events-none
" data-astro-cid-lejbfuzf> <span class="tooltip-text" data-astro-cid-lejbfuzf>LinkedIn</span> <div class="tooltip-arrow absolute left-1/2 -translate-x-1/2
  top-full w-4 h-2
  bg-secondary-accent
" data-astro-cid-lejbfuzf></div> </div> </div> <div class="group relative inline-flex" data-astro-cid-lejbfuzf> <!-- Whatever you put inside the TooltipWrapper tags goes here -->  <a href="https://www.reddit.com/submit?url=https%3A%2F%2Fandrecrafts.com%2Fposts%2Fwriting-custom-shellcode-cpp-to-asm-to-shellcode%2F&title=Writing%20custom%20Shellcode%3A%20C%2B%2B%20to%20ASM%20to%20Shellcode" target="_blank" rel="noopener noreferrer" class="p-2 rounded-lg bg-secondary-accent hover:bg-sky-600 text-subtle-gray hover:text-white transition-all duration-200"> <svg class="w-5 h-5<" xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-reddit" viewBox="0 0 16 16"> <path d="M6.167 8a.83.83 0 0 0-.83.83c0 .459.372.84.83.831a.831.831 0 0 0 0-1.661m1.843 3.647c.315 0 1.403-.038 1.976-.611a.23.23 0 0 0 0-.306.213.213 0 0 0-.306 0c-.353.363-1.126.487-1.67.487-.545 0-1.308-.124-1.671-.487a.213.213 0 0 0-.306 0 .213.213 0 0 0 0 .306c.564.563 1.652.61 1.977.61zm.992-2.807c0 .458.373.83.831.83s.83-.381.83-.83a.831.831 0 0 0-1.66 0z"></path> <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0m-3.828-1.165c-.315 0-.602.124-.812.325-.801-.573-1.9-.945-3.121-.993l.534-2.501 1.738.372a.83.83 0 1 0 .83-.869.83.83 0 0 0-.744.468l-1.938-.41a.2.2 0 0 0-.153.028.2.2 0 0 0-.086.134l-.592 2.788c-1.24.038-2.358.41-3.17.992-.21-.2-.496-.324-.81-.324a1.163 1.163 0 0 0-.478 2.224q-.03.17-.029.353c0 1.795 2.091 3.256 4.669 3.256s4.668-1.451 4.668-3.256c0-.114-.01-.238-.029-.353.401-.181.688-.592.688-1.069 0-.65-.525-1.165-1.165-1.165"></path> </svg> </a>  <div role="tooltip" class="tooltip
  absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1.5 
  text-sm font-medium bg-secondary-accent
  rounded-md shadow-lg w-max max-w-xs
  opacity-0 [@media_(hover:hover)]:group-hover:opacity-100
  transition-opacity duration-300 pointer-events-none
" data-astro-cid-lejbfuzf> <span class="tooltip-text" data-astro-cid-lejbfuzf>Reddit</span> <div class="tooltip-arrow absolute left-1/2 -translate-x-1/2
  top-full w-4 h-2
  bg-secondary-accent
" data-astro-cid-lejbfuzf></div> </div> </div> <!-- Copy Link Button --> <div class="group relative inline-flex copy-button-container" data-astro-cid-lejbfuzf> <!-- Whatever you put inside the TooltipWrapper tags goes here -->  <button class="cursor-pointer p-2 rounded-lg bg-secondary-accent hover:bg-sky-600 text-subtle-gray hover:text-white transition-all duration-200 copy-button" data-text="Copy Link" data-copy-value="https://andrecrafts.com/posts/writing-custom-shellcode-cpp-to-asm-to-shellcode/" aria-label="Copy Link" data-astro-cid-74lkg7sv> <!-- Button Content Slot -->  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"> <path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 011.242 7.244l-4.5 4.5a4.5 4.5 0 01-6.364-6.364l1.757-1.757m13.35-.622l1.757-1.757a4.5 4.5 0 00-6.364-6.364l-4.5 4.5a4.5 4.5 0 001.242 7.244"></path> </svg>  </button>  <div role="tooltip" class="tooltip
  absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1.5 
  text-sm font-medium bg-secondary-accent
  rounded-md shadow-lg w-max max-w-xs
  opacity-0 [@media_(hover:hover)]:group-hover:opacity-100
  transition-opacity duration-300 pointer-events-none
" data-astro-cid-lejbfuzf> <span class="tooltip-text" data-astro-cid-lejbfuzf>Copy Link</span> <div class="tooltip-arrow absolute left-1/2 -translate-x-1/2
  top-full w-4 h-2
  bg-secondary-accent
" data-astro-cid-lejbfuzf></div> </div> </div> <script type="module">function c(){const r=document.querySelectorAll(".copy-button-container");for(const n of r){const t=n.querySelector(".copy-button");if(!t||t.dataset.initialized)continue;t.dataset.initialized="true";const e=n.querySelector(".tooltip"),o=n.querySelector(".tooltip-text"),a=t.dataset.copyValue,i=t.dataset.text;!e||!o||!a||!i||(t.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(a),o.innerText="Copied!",e.classList.add("opacity-100")}catch{o.innerText="Copy Failed!",e.classList.add("opacity-100")}window.matchMedia("(hover: hover)").matches||(setTimeout(()=>{e.classList.remove("opacity-100")},1500),setTimeout(()=>{o.innerText=i},1800))}),t.addEventListener("mouseleave",()=>{window.matchMedia("(hover: hover)").matches&&(e.classList.remove("opacity-100"),setTimeout(()=>{o.innerText=i},300))}))}}c();document.addEventListener("DOMContentLoaded",c);</script>  </div> </div> </div> </div> </div> <button class="
flex justify-center items-center p-2 
cursor-pointer rounded-full
text-white bg-white/10 
hover:bg-white/30 rotate-90
fixed bottom-4 right-4 z-50 hidden lg:flex
 back-to-top mr-[2%]" aria-label="Back to top" data-astro-cid-scuu7fyy> <svg class="w-8 h-auto" data-astro-cid-scuu7fyy="true" fill="none" stroke="currentColor" viewBox="0 0 24 24"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path> </svg> </button> <section id="read-next" class="pt-4 pb-10 mt-10 bg-secondary"> <div class="text-center mb-2"> <h2 class="text-4xl font-bold text-white">Read Next</h2> </div> <!-- Work Card Carousel Container --><div class="flex items-center justify-center gap-2 w-fit mx-auto" data-astro-cid-oyovcjtc> <button id="scroll-left" class="
hidden md:flex 2xl:hidden p-2
text-white bg-white/10 rounded-full cursor-pointer
transition-all duration-300 hover:bg-white/30" aria-label="Scroll left" data-astro-cid-oyovcjtc> <svg class="w-8 h-8" data-astro-cid-oyovcjtc="true" fill="none" stroke="currentColor" viewBox="0 0 24 24"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path> </svg> </button> <div id="projects-carousel" class="
scroll-smooth overflow-x-auto hide-scrollbar
flex mx-auto gap-2 xl:gap-4 px-4 pt-6 pb-2
w-[19rem] sm:w-[23rem] md:w-[37rem]
2xl:overflow-visible 2xl:snap-none 2xl:justify-center 2xl:w-full relative" data-astro-cid-oyovcjtc> <div class="flex-shrink-0 w-60 sm:w-70 scroll-snap-center" data-astro-cid-r7kjq4ip> <div class="bg-secondary border-2 border-secondary-accent 
rounded-xl overflow-hidden flex flex-col h-full 
will-change-transform transition-all transform duration-300 
[@media(hover:hover)]:hover:border-sky-700 [@media(hover:hover)]:hover:text-sky-500 
[@media(hover:hover)]:hover:shadow-[0_0_20px_#3d95f540] [@media(hover:hover)]:hover:-translate-y-2" data-astro-cid-r7kjq4ip> <div class="relative" data-astro-cid-r7kjq4ip> <a href="/posts/hide-shellcode-in-images" data-astro-cid-r7kjq4ip> <div class="w-full aspect-[204/100] rounded-lg 
bg-black flex justify-center items-center" data-astro-cid-r7kjq4ip> <!-- If scale exists, then apply the img-class class --><img src="/_astro/hiding_shellcode_in_Images.DZ1-0QCA_Z2a1HO.png" alt="Hiding Shellcode in Images with Python and C/C++" data-astro-cid-r7kjq4ip="true" data-full-src="/_astro/hiding_shellcode_in_Images.DZ1-0QCA.png" data-astro-cid-qqdm6bys="true" loading="lazy" decoding="async" fetchpriority="auto" width="1286" height="630" class="w-auto h-full img-class">  </div> </a> <a class="absolute top-1.5 right-1.5
flex justify-center items-center p-2 rounded-full
bg-gray-800/60 text-white hover:bg-gray-800/80 
transition-colors duration-200 transform" href="https://github.com/andrecrafts/hide-payload-in-images" target="_blank" rel="noopener noreferrer" aria-label="View Project on Github" data-astro-cid-r7kjq4ip> <svg class="w-5 h-5" data-astro-cid-r7kjq4ip="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"> <g transform="translate(12, 12) scale(0.98) translate(-12, -12)"> <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path> </g> </svg> </a> </div> <a href="/posts/hide-shellcode-in-images" class="m-4 flex flex-col flex-grow overflow-hidden" data-astro-cid-r7kjq4ip> <h3 class="title-clamp text-lg leading-tight font-bold mb-2" title="Hiding Shellcode in Images with Python and C/C++" data-astro-cid-r7kjq4ip>Hiding Shellcode in Images with Python and C/C++</h3> <p class="description-clamp text-sm text-subtle-gray mb-4 break-all" title="Learn how to hide shellcode payloads in plain sight by embedding them into image files, such as PNGs, using Python." data-astro-cid-r7kjq4ip>Learn how to hide shellcode payloads in plain sight by embedding them into image files, such as PNGs, using Python.</p> <div class="mt-auto" data-astro-cid-r7kjq4ip> <div title="Python, C++, Malware, Red Team, EDR Evasion, Cybersecurity, Hacking, Steganography, Payload Hiding, Programming" class="flex gap-2 mb-4" data-astro-cid-r7kjq4ip>  <span class="whitespace-nowrap text-xs text-white bg-secondary-accent px-1.7 py-1 rounded-md" data-astro-cid-r7kjq4ip>Python</span><span class="whitespace-nowrap text-xs text-white bg-secondary-accent px-1.7 py-1 rounded-md" data-astro-cid-r7kjq4ip>C++</span><span class="whitespace-nowrap text-xs text-white bg-secondary-accent px-1.7 py-1 rounded-md" data-astro-cid-r7kjq4ip>Malware</span> </div> <div class="flex items-center text-sm text-subtle-gray" data-astro-cid-r7kjq4ip> <span class="mr-auto" data-astro-cid-r7kjq4ip>17 Dec 2024</span> <span data-astro-cid-r7kjq4ip>203</span>
            <svg class="w-5 h-5 text-yellow-400 -mt-1 ml-1" data-astro-cid-r7kjq4ip="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"> <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon> </svg> </div> </div> </a> </div> </div> <div class="flex-shrink-0 w-60 sm:w-70 scroll-snap-center" data-astro-cid-r7kjq4ip> <div class="bg-secondary border-2 border-secondary-accent 
rounded-xl overflow-hidden flex flex-col h-full 
will-change-transform transition-all transform duration-300 
[@media(hover:hover)]:hover:border-sky-700 [@media(hover:hover)]:hover:text-sky-500 
[@media(hover:hover)]:hover:shadow-[0_0_20px_#3d95f540] [@media(hover:hover)]:hover:-translate-y-2" data-astro-cid-r7kjq4ip> <div class="relative" data-astro-cid-r7kjq4ip> <a href="/posts/bypass-yara-rule-cobaltstrike" data-astro-cid-r7kjq4ip> <div class="w-full aspect-[204/100] rounded-lg 
bg-black flex justify-center items-center" data-astro-cid-r7kjq4ip> <!-- If scale exists, then apply the img-class class --><img src="/_astro/bypass_yara_f0b627fc_evade_edrs.D_48sdOF_ZHMefM.png" alt="Bypass YARA Rule f0b627fc for CobaltStrike to Evade EDRs" data-astro-cid-r7kjq4ip="true" data-full-src="/_astro/bypass_yara_f0b627fc_evade_edrs.D_48sdOF.png" data-astro-cid-qqdm6bys="true" loading="lazy" decoding="async" fetchpriority="auto" width="1285" height="630" class="w-auto h-full img-class">  </div> </a> <a class="absolute top-1.5 right-1.5
flex justify-center items-center p-2 rounded-full
bg-gray-800/60 text-white hover:bg-gray-800/80 
transition-colors duration-200 transform" href="https://github.com/andrecrafts/CobaltStrike-YARA-Bypass-f0b627fc" target="_blank" rel="noopener noreferrer" aria-label="View Project on Github" data-astro-cid-r7kjq4ip> <svg class="w-5 h-5" data-astro-cid-r7kjq4ip="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"> <g transform="translate(12, 12) scale(0.98) translate(-12, -12)"> <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path> </g> </svg> </a> </div> <a href="/posts/bypass-yara-rule-cobaltstrike" class="m-4 flex flex-col flex-grow overflow-hidden" data-astro-cid-r7kjq4ip> <h3 class="title-clamp text-lg leading-tight font-bold mb-2" title="Bypass YARA Rule f0b627fc for CobaltStrike to Evade EDRs" data-astro-cid-r7kjq4ip>Bypass YARA Rule f0b627fc for CobaltStrike to Evade EDRs</h3> <p class="description-clamp text-sm text-subtle-gray mb-4 break-all" title="Bypass Yara Rule Windows_Trojan_CobaltStrike_f0b627fc by randomizing its shellcode signature using a Python script." data-astro-cid-r7kjq4ip>Bypass Yara Rule Windows_Trojan_CobaltStrike_f0b627fc by randomizing its shellcode signature using a Python script.</p> <div class="mt-auto" data-astro-cid-r7kjq4ip> <div title="EDR Evasion, Cobalt Strike, Python, YARA Evasion, Shellcode, Red Team, Programming" class="flex gap-2 mb-4" data-astro-cid-r7kjq4ip>  <span class="whitespace-nowrap text-xs text-white bg-secondary-accent px-1.7 py-1 rounded-md" data-astro-cid-r7kjq4ip>EDR Evasion</span><span class="whitespace-nowrap text-xs text-white bg-secondary-accent px-1.7 py-1 rounded-md" data-astro-cid-r7kjq4ip>Cobalt Strike</span> </div> <div class="flex items-center text-sm text-subtle-gray" data-astro-cid-r7kjq4ip> <span class="mr-auto" data-astro-cid-r7kjq4ip>16 Oct 2024</span> <span data-astro-cid-r7kjq4ip>45</span>
            <svg class="w-5 h-5 text-yellow-400 -mt-1 ml-1" data-astro-cid-r7kjq4ip="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"> <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon> </svg> </div> </div> </a> </div> </div> <div class="flex-shrink-0 w-60 sm:w-70 scroll-snap-center" data-astro-cid-r7kjq4ip> <div class="bg-secondary border-2 border-secondary-accent 
rounded-xl overflow-hidden flex flex-col h-full 
will-change-transform transition-all transform duration-300 
[@media(hover:hover)]:hover:border-sky-700 [@media(hover:hover)]:hover:text-sky-500 
[@media(hover:hover)]:hover:shadow-[0_0_20px_#3d95f540] [@media(hover:hover)]:hover:-translate-y-2" data-astro-cid-r7kjq4ip> <div class="relative" data-astro-cid-r7kjq4ip> <a href="/projects/dynamic-https-payload-stager" data-astro-cid-r7kjq4ip> <div class="w-full aspect-[204/100] rounded-lg 
bg-black flex justify-center items-center" data-astro-cid-r7kjq4ip> <!-- If scale exists, then apply the img-class class --><img src="/_astro/dynamic_payload_stager.0vh2wwpQ_ZgFO4C.png" alt="Dynamic HTTP/s Payload Stager" data-astro-cid-r7kjq4ip="true" data-full-src="/_astro/dynamic_payload_stager.0vh2wwpQ.png" data-astro-cid-qqdm6bys="true" loading="lazy" decoding="async" fetchpriority="auto" width="1285" height="630" class="w-auto h-full img-class">  </div> </a> <a class="absolute top-1.5 right-1.5
flex justify-center items-center p-2 rounded-full
bg-gray-800/60 text-white hover:bg-gray-800/80 
transition-colors duration-200 transform" href="https://github.com/andrecrafts/Dynamic-HTTP-Payload-Stager" target="_blank" rel="noopener noreferrer" aria-label="View Project on Github" data-astro-cid-r7kjq4ip> <svg class="w-5 h-5" data-astro-cid-r7kjq4ip="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"> <g transform="translate(12, 12) scale(0.98) translate(-12, -12)"> <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path> </g> </svg> </a> </div> <a href="/projects/dynamic-https-payload-stager" class="m-4 flex flex-col flex-grow overflow-hidden" data-astro-cid-r7kjq4ip> <h3 class="title-clamp text-lg leading-tight font-bold mb-2" title="Dynamic HTTP/s Payload Stager" data-astro-cid-r7kjq4ip>Dynamic HTTP/s Payload Stager</h3> <p class="description-clamp text-sm text-subtle-gray mb-4 break-all" title="A dynamic HTTP/S stager that lets one shellcode loader be reused for different encrypted payloads - no rebuilds." data-astro-cid-r7kjq4ip>A dynamic HTTP/S stager that lets one shellcode loader be reused for different encrypted payloads - no rebuilds.</p> <div class="mt-auto" data-astro-cid-r7kjq4ip> <div title="Payload Stager, C++, Python, EDR Evasion, Red team, Malware Development, C, Hacking, Programming, Encryption, Obfuscation, Malware" class="flex gap-2 mb-4" data-astro-cid-r7kjq4ip>  <span class="whitespace-nowrap text-xs text-white bg-secondary-accent px-1.7 py-1 rounded-md" data-astro-cid-r7kjq4ip>Payload Stager</span><span class="whitespace-nowrap text-xs text-white bg-secondary-accent px-1.7 py-1 rounded-md" data-astro-cid-r7kjq4ip>C++</span><span class="whitespace-nowrap text-xs text-white bg-secondary-accent px-1.7 py-1 rounded-md" data-astro-cid-r7kjq4ip>Python</span> </div> <div class="flex items-center text-sm text-subtle-gray" data-astro-cid-r7kjq4ip> <span class="mr-auto" data-astro-cid-r7kjq4ip>12 Sept 2024</span> <span data-astro-cid-r7kjq4ip>19</span>
            <svg class="w-5 h-5 text-yellow-400 -mt-1 ml-1" data-astro-cid-r7kjq4ip="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"> <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon> </svg> </div> </div> </a> </div> </div> <div class="flex-shrink-0 w-60 sm:w-70 scroll-snap-center" data-astro-cid-r7kjq4ip> <div class="bg-secondary border-2 border-secondary-accent 
rounded-xl overflow-hidden flex flex-col h-full 
will-change-transform transition-all transform duration-300 
[@media(hover:hover)]:hover:border-sky-700 [@media(hover:hover)]:hover:text-sky-500 
[@media(hover:hover)]:hover:shadow-[0_0_20px_#3d95f540] [@media(hover:hover)]:hover:-translate-y-2" data-astro-cid-r7kjq4ip> <div class="relative" data-astro-cid-r7kjq4ip> <a href="/posts/convert-bloodhound-legacy-queries-to-ce" data-astro-cid-r7kjq4ip> <div class="w-full aspect-[204/100] rounded-lg 
bg-black flex justify-center items-center" data-astro-cid-r7kjq4ip> <!-- If scale exists, then apply the img-class class --><img src="/_astro/blood-hound.DWEY7bi5_yIOW0.png" alt="How to Convert Custom Queries from BloodHound Legacy to BloodHound CE" data-astro-cid-r7kjq4ip="true" data-full-src="/_astro/blood-hound.DWEY7bi5.png" data-astro-cid-qqdm6bys="true" loading="lazy" decoding="async" fetchpriority="auto" width="1286" height="630" class="w-auto h-full img-class">  </div> </a> <a class="absolute top-1.5 right-1.5
flex justify-center items-center p-2 rounded-full
bg-gray-800/60 text-white hover:bg-gray-800/80 
transition-colors duration-200 transform" href="https://github.com/andrecrafts/Bloodhound-query-legacy2ce" target="_blank" rel="noopener noreferrer" aria-label="View Project on Github" data-astro-cid-r7kjq4ip> <svg class="w-5 h-5" data-astro-cid-r7kjq4ip="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"> <g transform="translate(12, 12) scale(0.98) translate(-12, -12)"> <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path> </g> </svg> </a> </div> <a href="/posts/convert-bloodhound-legacy-queries-to-ce" class="m-4 flex flex-col flex-grow overflow-hidden" data-astro-cid-r7kjq4ip> <h3 class="title-clamp text-lg leading-tight font-bold mb-2" title="How to Convert Custom Queries from BloodHound Legacy to BloodHound CE" data-astro-cid-r7kjq4ip>How to Convert Custom Queries from BloodHound Legacy to BloodHound CE</h3> <p class="description-clamp text-sm text-subtle-gray mb-4 break-all" title="Complete guide to migrate and convert custom queries from Legacy BloodHound to BloodHound CE (Community Edition)." data-astro-cid-r7kjq4ip>Complete guide to migrate and convert custom queries from Legacy BloodHound to BloodHound CE (Community Edition).</p> <div class="mt-auto" data-astro-cid-r7kjq4ip> <div title="BloodHound, Red Team, Python, Security Tools, Active Directory, Network Security, Pentesting, Hacking, Programming" class="flex gap-2 mb-4" data-astro-cid-r7kjq4ip>  <span class="whitespace-nowrap text-xs text-white bg-secondary-accent px-1.7 py-1 rounded-md" data-astro-cid-r7kjq4ip>BloodHound</span><span class="whitespace-nowrap text-xs text-white bg-secondary-accent px-1.7 py-1 rounded-md" data-astro-cid-r7kjq4ip>Red Team</span><span class="whitespace-nowrap text-xs text-white bg-secondary-accent px-1.7 py-1 rounded-md" data-astro-cid-r7kjq4ip>Python</span> </div> <div class="flex items-center text-sm text-subtle-gray" data-astro-cid-r7kjq4ip> <span class="mr-auto" data-astro-cid-r7kjq4ip>9 Jan 2025</span> <span data-astro-cid-r7kjq4ip>31</span>
            <svg class="w-5 h-5 text-yellow-400 -mt-1 ml-1" data-astro-cid-r7kjq4ip="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"> <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon> </svg> </div> </div> </a> </div> </div>  </div> <button id="scroll-right" class="
hidden md:flex 2xl:hidden p-2
text-white bg-white/10 rounded-full cursor-pointer
transition-all duration-300 hover:bg-white/30 rotate-180" aria-label="Scroll right" data-astro-cid-oyovcjtc> <svg class="w-8 h-8" data-astro-cid-oyovcjtc="true" fill="none" stroke="currentColor" viewBox="0 0 24 24"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path> </svg> </button> </div> <div id="dots-container" class="carousel-dots flex justify-center
gap-3 mt-4 2xl:hidden" data-astro-cid-oyovcjtc> <div class="dot
[@media(hover:hover)]:hover:bg-sky-500
w-2.5 h-2.5 rounded-full cursor-pointer
bg-white/30 transition-all duration-200" data-astro-cid-oyovcjtc></div><div class="dot
[@media(hover:hover)]:hover:bg-sky-500
w-2.5 h-2.5 rounded-full cursor-pointer
bg-white/30 transition-all duration-200" data-astro-cid-oyovcjtc></div><div class="dot
[@media(hover:hover)]:hover:bg-sky-500
w-2.5 h-2.5 rounded-full cursor-pointer
bg-white/30 transition-all duration-200" data-astro-cid-oyovcjtc></div><div class="dot
[@media(hover:hover)]:hover:bg-sky-500
w-2.5 h-2.5 rounded-full cursor-pointer
bg-white/30 transition-all duration-200" data-astro-cid-oyovcjtc></div><div class="dot
[@media(hover:hover)]:hover:bg-sky-500
w-2.5 h-2.5 rounded-full cursor-pointer
bg-white/30 transition-all duration-200" data-astro-cid-oyovcjtc></div><div class="dot
[@media(hover:hover)]:hover:bg-sky-500
w-2.5 h-2.5 rounded-full cursor-pointer
bg-white/30 transition-all duration-200" data-astro-cid-oyovcjtc></div> </div> <script type="module">function u(){const t=document.getElementById("projects-carousel"),i=document.getElementById("dots-container");if(!t||!i)return;const n=Array.from(t.children),o=Array.from(i.children);if(n.length===0||o.length===0)return;const h=window.matchMedia("(min-width: 768px)"),c=window.matchMedia("(min-width: 1536px)"),a=new IntersectionObserver(e=>{const l=e.find(s=>s.isIntersecting);if(!l)return;const m=n.indexOf(l.target);let r;h.matches?r=Math.floor(m/2):r=m,o.forEach((s,f)=>{s.classList.toggle("active",f===r)})},{root:t,threshold:.95});function d(){c.matches?(a.disconnect(),o.forEach(e=>e.classList.remove("active"))):n.forEach(e=>a.observe(e))}c.addEventListener("change",d),d()}document.addEventListener("DOMContentLoaded",u);</script> <script type="module">function m(){const r=document.getElementById("projects-carousel"),c=document.getElementById("scroll-left"),i=document.getElementById("scroll-right"),s=document.getElementById("dots-container");if(!r||!c||!i||!s)return;const t=Array.from(r.children);if(t.length===0)return;const o=Array.from(s.children);if(o.length===0)return;const a=window.matchMedia("(min-width: 768px)");function n(e){const d=t[e];let l="center";e===0?l="center":e===t.length-1&&(l="end"),d.scrollIntoView({behavior:"smooth",inline:l,block:"nearest"})}c.addEventListener("click",()=>{n(0)}),i.addEventListener("click",()=>{n(t.length-1)});for(let e=0;e<o.length;e++)o[e].addEventListener("click",()=>{if(!a.matches){n(e);return}e===0?n(0):e===1&&n(t.length-1)})}document.addEventListener("DOMContentLoaded",m);</script>  <div class="flex justify-center gap-4 flex-col 
items-center mt-10"> <a class="
text-white font-bold text-lg
rounded-lg py-3 px-5
will-change-transform transform transition-all duration-300 bg-secondary-accent
hover:ring-white hover:bg-white hover:text-black hover:scale-105" href="/work">View more</a> </div> </section> <div class="lg:hidden" data-astro-cid-scuu7fyy> <div class="back-to-top z-50 lg:hidden fixed bottom-0 left-0 right-0 flex justify-center items-center
    bg-header border-t border-l border-r border-white/10 rounded-t-lg cursor-pointer" data-astro-cid-scuu7fyy> <svg class="w-6 h-6 rotate-90" data-astro-cid-scuu7fyy="true" fill="none" stroke="currentColor" viewBox="0 0 24 24"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path> </svg> </div> <astro-modal data-unique-id="modal-toc-trigger" data-trigger-selector="toc-trigger" data-astro-cid-qmzm2soj="true"> <div id="modal-toc-trigger" class="modal-container z-10 fixed inset-0 bg-black/60 flex items-center justify-center p-4" data-astro-cid-qmzm2soj> <div class="bg-header rounded-lg max-w-md md:max-w-2xl max-h-[60vh] flex flex-col" data-astro-cid-qmzm2soj> <header class="py-2 px-3 flex justify-between items-center border-b border-gray-700" data-astro-cid-qmzm2soj> <h2 class="font-semibold text-lg" data-astro-cid-qmzm2soj>Table of Contents</h2> <button class="close-modal-btn cursor-pointer" data-astro-cid-qmzm2soj> <svg class="h-6 w-6" data-astro-cid-qmzm2soj="true" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"> <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path> </svg> </button> </header>  <div class="overflow-y-auto scroll-fade-container py-3 px-2 flex-1 md:text-lg" data-astro-cid-qmzm2soj>  <ul class="pl-3 pr-2 " data-astro-cid-xvrfupwn>  </ul>    </div> </div> </div> </astro-modal> <script type="module">function c(s){if(!s)return;const t=()=>{if(!(s.scrollHeight>s.clientHeight)){s.classList.remove("is-scrolling","is-at-top","is-at-bottom");return}const e=s.scrollTop<1,i=s.scrollHeight-s.scrollTop<=s.clientHeight+1;e?(s.classList.add("is-at-top"),s.classList.remove("is-scrolling","is-at-bottom")):i?(s.classList.add("is-at-bottom"),s.classList.remove("is-scrolling","is-at-top")):(s.classList.add("is-scrolling"),s.classList.remove("is-at-top","is-at-bottom"))};s.addEventListener("scroll",t),window.addEventListener("resize",t),new MutationObserver(t).observe(s,{childList:!0,subtree:!0}),t()}document.querySelectorAll(".scroll-fade-container").forEach(s=>{c(s)});</script>  <script type="module">class i extends HTMLElement{connectedCallback(){const r=this.dataset.uniqueId,n=this.dataset.triggerSelector,e=this.querySelector(`#${r}`);if(!e){console.error("Modal container not found!");return}function t(){e.classList.toggle("show")}function c(){const o=document.querySelector(`#${n}`);if(!o){console.error(`Modal trigger element "${n}" not found!`);return}const l=e.querySelector(".close-modal-btn");o.addEventListener("click",t),l?.addEventListener("click",t),e.addEventListener("click",s=>{s.target===e&&t()})}c()}}customElements.define("astro-modal",i);</script>  </div> <astro-modal data-unique-id="modal-share-trigger" data-trigger-selector="share-trigger" data-astro-cid-qmzm2soj="true"> <div id="modal-share-trigger" class="modal-container z-10 fixed inset-0 bg-black/60 flex items-center justify-center p-4" data-astro-cid-qmzm2soj> <div class="bg-header rounded-lg max-w-md md:max-w-2xl max-h-[60vh] flex flex-col" data-astro-cid-qmzm2soj> <header class="py-2 px-3 flex justify-between items-center border-b border-gray-700" data-astro-cid-qmzm2soj> <h2 class="font-semibold text-lg" data-astro-cid-qmzm2soj>Share</h2> <button class="close-modal-btn cursor-pointer" data-astro-cid-qmzm2soj> <svg class="h-6 w-6" data-astro-cid-qmzm2soj="true" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"> <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path> </svg> </button> </header>  <div class="scroll-fade-container py-3 px-2 flex-1 md:text-lg" data-astro-cid-qmzm2soj>  <div class="flex items-center gap-2"> <!-- Twitter --> <div class="group relative inline-flex" data-astro-cid-lejbfuzf> <!-- Whatever you put inside the TooltipWrapper tags goes here -->  <a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fandrecrafts.com%2Fposts%2Fwriting-custom-shellcode-cpp-to-asm-to-shellcode%2F&text=Writing%20custom%20Shellcode%3A%20C%2B%2B%20to%20ASM%20to%20Shellcode" target="_blank" rel="noopener noreferrer" class="p-2 rounded-lg bg-secondary-accent hover:bg-sky-600 text-subtle-gray hover:text-white transition-all duration-200"> <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"> <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.25 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"></path> </svg> </a>  <div role="tooltip" class="tooltip
  absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1.5 
  text-sm font-medium bg-secondary-accent
  rounded-md shadow-lg w-max max-w-xs
  opacity-0 [@media_(hover:hover)]:group-hover:opacity-100
  transition-opacity duration-300 pointer-events-none
" data-astro-cid-lejbfuzf> <span class="tooltip-text" data-astro-cid-lejbfuzf>Twitter</span> <div class="tooltip-arrow absolute left-1/2 -translate-x-1/2
  top-full w-4 h-2
  bg-secondary-accent
" data-astro-cid-lejbfuzf></div> </div> </div> <!-- LinkedIn --> <div class="group relative inline-flex" data-astro-cid-lejbfuzf> <!-- Whatever you put inside the TooltipWrapper tags goes here -->  <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fandrecrafts.com%2Fposts%2Fwriting-custom-shellcode-cpp-to-asm-to-shellcode%2F" target="_blank" rel="noopener noreferrer" class="p-2 rounded-lg bg-secondary-accent hover:bg-sky-600 text-subtle-gray hover:text-white transition-all duration-200"> <svg class="w-5 h-5<" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"> <path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"></path> </svg> </a>  <div role="tooltip" class="tooltip
  absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1.5 
  text-sm font-medium bg-secondary-accent
  rounded-md shadow-lg w-max max-w-xs
  opacity-0 [@media_(hover:hover)]:group-hover:opacity-100
  transition-opacity duration-300 pointer-events-none
" data-astro-cid-lejbfuzf> <span class="tooltip-text" data-astro-cid-lejbfuzf>LinkedIn</span> <div class="tooltip-arrow absolute left-1/2 -translate-x-1/2
  top-full w-4 h-2
  bg-secondary-accent
" data-astro-cid-lejbfuzf></div> </div> </div> <div class="group relative inline-flex" data-astro-cid-lejbfuzf> <!-- Whatever you put inside the TooltipWrapper tags goes here -->  <a href="https://www.reddit.com/submit?url=https%3A%2F%2Fandrecrafts.com%2Fposts%2Fwriting-custom-shellcode-cpp-to-asm-to-shellcode%2F&title=Writing%20custom%20Shellcode%3A%20C%2B%2B%20to%20ASM%20to%20Shellcode" target="_blank" rel="noopener noreferrer" class="p-2 rounded-lg bg-secondary-accent hover:bg-sky-600 text-subtle-gray hover:text-white transition-all duration-200"> <svg class="w-5 h-5<" xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-reddit" viewBox="0 0 16 16"> <path d="M6.167 8a.83.83 0 0 0-.83.83c0 .459.372.84.83.831a.831.831 0 0 0 0-1.661m1.843 3.647c.315 0 1.403-.038 1.976-.611a.23.23 0 0 0 0-.306.213.213 0 0 0-.306 0c-.353.363-1.126.487-1.67.487-.545 0-1.308-.124-1.671-.487a.213.213 0 0 0-.306 0 .213.213 0 0 0 0 .306c.564.563 1.652.61 1.977.61zm.992-2.807c0 .458.373.83.831.83s.83-.381.83-.83a.831.831 0 0 0-1.66 0z"></path> <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0m-3.828-1.165c-.315 0-.602.124-.812.325-.801-.573-1.9-.945-3.121-.993l.534-2.501 1.738.372a.83.83 0 1 0 .83-.869.83.83 0 0 0-.744.468l-1.938-.41a.2.2 0 0 0-.153.028.2.2 0 0 0-.086.134l-.592 2.788c-1.24.038-2.358.41-3.17.992-.21-.2-.496-.324-.81-.324a1.163 1.163 0 0 0-.478 2.224q-.03.17-.029.353c0 1.795 2.091 3.256 4.669 3.256s4.668-1.451 4.668-3.256c0-.114-.01-.238-.029-.353.401-.181.688-.592.688-1.069 0-.65-.525-1.165-1.165-1.165"></path> </svg> </a>  <div role="tooltip" class="tooltip
  absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1.5 
  text-sm font-medium bg-secondary-accent
  rounded-md shadow-lg w-max max-w-xs
  opacity-0 [@media_(hover:hover)]:group-hover:opacity-100
  transition-opacity duration-300 pointer-events-none
" data-astro-cid-lejbfuzf> <span class="tooltip-text" data-astro-cid-lejbfuzf>Reddit</span> <div class="tooltip-arrow absolute left-1/2 -translate-x-1/2
  top-full w-4 h-2
  bg-secondary-accent
" data-astro-cid-lejbfuzf></div> </div> </div> <!-- Copy Link Button --> <div class="group relative inline-flex copy-button-container" data-astro-cid-lejbfuzf> <!-- Whatever you put inside the TooltipWrapper tags goes here -->  <button class="cursor-pointer p-2 rounded-lg bg-secondary-accent hover:bg-sky-600 text-subtle-gray hover:text-white transition-all duration-200 copy-button" data-text="Copy Link" data-copy-value="https://andrecrafts.com/posts/writing-custom-shellcode-cpp-to-asm-to-shellcode/" aria-label="Copy Link" data-astro-cid-74lkg7sv> <!-- Button Content Slot -->  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"> <path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 011.242 7.244l-4.5 4.5a4.5 4.5 0 01-6.364-6.364l1.757-1.757m13.35-.622l1.757-1.757a4.5 4.5 0 00-6.364-6.364l-4.5 4.5a4.5 4.5 0 001.242 7.244"></path> </svg>  </button>  <div role="tooltip" class="tooltip
  absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1.5 
  text-sm font-medium bg-secondary-accent
  rounded-md shadow-lg w-max max-w-xs
  opacity-0 [@media_(hover:hover)]:group-hover:opacity-100
  transition-opacity duration-300 pointer-events-none
" data-astro-cid-lejbfuzf> <span class="tooltip-text" data-astro-cid-lejbfuzf>Copy Link</span> <div class="tooltip-arrow absolute left-1/2 -translate-x-1/2
  top-full w-4 h-2
  bg-secondary-accent
" data-astro-cid-lejbfuzf></div> </div> </div>   </div>  </div> </div> </div> </astro-modal>     <dialog id="image-modal" class="modal-container bg-transparent p-0 max-w-full max-h-full w-full h-full backdrop:bg-black/80" data-astro-cid-qj24g3rp> <!-- Modal Content Container --> <div class="modal-container relative w-full h-full flex items-center justify-center p-4 md:p-8" data-astro-cid-qj24g3rp> <!-- Close Button --> <button id="modal-close-btn" class="modal-container outline-none cursor-pointer absolute top-13 right-13 z-20 text-white bg-gray-600 hover:bg-gray-500  rounded-full p-2 transition-colors" aria-label="Close image viewer" data-astro-cid-qj24g3rp> <svg class="w-6 h-6" data-astro-cid-qj24g3rp="true" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"> <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path> </svg> </button> <!-- Image Wrapper for zooming --> <div class="modal-container relative w-full h-full flex items-center justify-center" data-astro-cid-qj24g3rp> <img id="modal-image" src="" alt="" class="max-w-full max-h-full object-contain transition-transform duration-300 ease-in-out cursor-zoom-in" data-zoomed="false" data-astro-cid-qj24g3rp> </div> </div> </dialog> <script type="module">document.addEventListener("DOMContentLoaded",()=>{const n=document.getElementById("image-modal"),a=document.querySelectorAll(".modal-container"),e=document.getElementById("modal-image"),c=document.querySelector("article");if(!n||!e||!a||!c)return;c.querySelectorAll(".img-class").forEach(o=>{o.addEventListener("click",()=>{const l=o.dataset.fullSrc||o.src;e.src=l,e.alt=o.alt,e.dataset.zoomed="false",n.showModal(),document.body.style.overflow="hidden"})});function d(o){if(o.stopPropagation(),e.dataset.zoomed==="true")e.dataset.zoomed="false";else{const t=e.getBoundingClientRect(),r=o.clientX-t.left,i=o.clientY-t.top,m=r/t.width*100,f=i/t.height*100;e.style.transformOrigin=`${m}% ${f}%`,e.dataset.zoomed="true"}}e.addEventListener("click",d);const s=()=>{n.close(),document.body.style.overflow=""};for(const o of a)o.addEventListener("click",s)});</script>   </main> <footer id="contact" class="bg-header border-t-1 border-white " data-astro-cid-sz7xmlte> <div class="container mx-auto pt-8 pb-10 px-4 text-center" data-astro-cid-sz7xmlte> <h2 class="text-3xl sm:text-4xl font-bold text-white mb-6 2xl:mb-4" data-astro-cid-sz7xmlte>
Let's Build Something Together
</h2> <p class="mb-6 text-lg" data-astro-cid-sz7xmlte>
Have a project in mind or just want to chat?
<br data-astro-cid-sz7xmlte>Feel free to reach out at
<span id="email-text" class="font-bold" data-astro-cid-sz7xmlte>andrecrafts.work@gmail.com</span> <button id="copy-button" class="-mt-1 -ml-0.5 
relative group inline-flex items-baseline 
highlight-btn cursor-pointer transition-colors duration-300
" aria-label="Copy email address" data-astro-cid-sz7xmlte> <svg class="w-6 h-6 translate-y-1.7" data-astro-cid-sz7xmlte="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"> <path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path> </svg> <div id="tooltip" role="tooltip" class="
absolute md:text-nowrap -top-7.1 left-1/2 -translate-x-1/2 z-10 px-1 py-1 
text-sm font-medium text-white bg-secondary-accent 
rounded-sm shadow-sm opacity-0 
[@media_(hover:hover)]:group-hover:opacity-100 pointer-events-none transition-opacity duration-300" data-astro-cid-sz7xmlte> <span id="tooltip-text" data-astro-cid-sz7xmlte>Copy email</span> <div class="
tooltip-arrow absolute w-3 h-1.5 top-full left-1/2 -translate-x-1/2" data-astro-cid-sz7xmlte></div> </div> </button> </p> <a href="https://cal.com/andrecrafts/meet" target="_blank" rel="noopener noreferrer" aria-label="Google Calendar Meeting" class="
  text-white text-lg font-bold 
  py-3 px-6 mb-8 rounded-lg inline-block 
  bg-sky-500 transition-all duration-300
  hover:scale-105 hover:bg-sky-400 transform will-change-transform" data-astro-cid-sz7xmlte>
Schedule Meeting
</a> <div class="flex justify-center space-x-6 mb-6" data-astro-cid-sz7xmlte> <a href="https://github.com/andrecrafts" target="_blank" rel="noopener noreferrer" aria-label="GitHub" class="hover:text-sky-500 transition-colors duration-300" data-astro-cid-sz7xmlte> <svg class="w-8 h-8" data-astro-cid-sz7xmlte="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"> <g transform="translate(12, 12) scale(0.98) translate(-12, -12)"> <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path> </g> </svg> </a> <a href="https://linkedin.com/in/andre0liveira" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn" class="hover:text-sky-500 transition-colors duration-300" data-astro-cid-sz7xmlte> <svg class="w-8 h-8" data-astro-cid-sz7xmlte="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"> <path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"></path> </svg> </a> </div> <p class="text-sm text-slate-300" data-astro-cid-sz7xmlte>
© 2025 AndreCrafts. All Rights Reserved.
</p> </div> </footer> <script type="module">function a(){const t=document.getElementById("copy-button"),e=document.getElementById("tooltip"),o=document.getElementById("tooltip-text");!t||!e||!o||(t.addEventListener("click",async()=>{try{await navigator.clipboard.writeText("andrecrafts.work@gmail.com"),o.innerText="Copied!",e.classList.add("opacity-100")}catch(n){console.error(n);return}window.matchMedia("(hover: hover)").matches||(t.classList.add("highlight-btn"),setTimeout(()=>{e.classList.remove("opacity-100"),t.classList.remove("highlight-btn")},1500),setTimeout(()=>{o.innerText="Copy email"},1800))}),t.addEventListener("mouseleave",()=>{window.matchMedia("(hover: hover)").matches&&(e.classList.remove("opacity-100"),setTimeout(()=>{o.innerText="Copy email"},300))}))}document.addEventListener("DOMContentLoaded",a);</script>  </body></html>   <script type="module">document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("tags-wrapper"),t=document.getElementById("show-all-btn"),n=document.getElementById("show-less-btn");if(!e||!t||!n)return;const s=()=>{const d=e.getAttribute("aria-expanded")==="true";e.setAttribute("aria-expanded",String(!d)),d?t.focus():n.focus()};t.addEventListener("click",s),n.addEventListener("click",s)});</script> <script type="module">function e(o,t){window.scrollY>t?o.classList.add("show"):o.classList.remove("show")}function s(){window.scrollTo({top:0,behavior:"smooth"})}function i(){const o=document.querySelectorAll(".back-to-top");if(o.length===0)return;const t=200;for(const n of o)n.addEventListener("click",s);window.addEventListener("scroll",()=>{for(const n of o)e(n,t)})}document.addEventListener("DOMContentLoaded",i);</script> <script type="module">function n(){const e=document.querySelector('h2[data-active="true"], h3[data-active="true"]');if(document.querySelectorAll("a.toc-link-mobile").forEach(t=>t.setAttribute("data-active","false")),e){const t=e.id,o=document.querySelector(`a.toc-link-mobile[href="#${t}"]`);o?.setAttribute("data-active","true"),o?.scrollIntoView({behavior:"smooth",block:"center"})}}function l(){const e=document.getElementById("modal-toc-trigger"),c=document.getElementById("toc-trigger"),t=document.querySelectorAll(".toc-link-mobile");if(!e||!c||!t)return;function o(){e.classList.toggle("show")}c.addEventListener("click",()=>{n()}),t.forEach(i=>{i.addEventListener("click",o)})}document.addEventListener("DOMContentLoaded",l);</script> 